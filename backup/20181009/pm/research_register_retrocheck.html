<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>:: RMIS :: สำหรับหัวหน้าโครงการ ::</title>

	<!-- Data table CSS -->
	<link href="../v3/vendors/bower_components/datatables/media/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css"/>
  <!-- switchery CSS -->
	<link href="../v3/vendors/bower_components/switchery/dist/switchery.min.css" rel="stylesheet" type="text/css"/>

  <link rel="stylesheet" href="../v3/vendors/bower_components/dropzonejs/dropzone.min.css" />
  <!--alerts CSS -->
	<link href="../v3/vendors/bower_components/sweetalert/dist/sweetalert.css" rel="stylesheet" type="text/css">

  <!-- bootstrap-select CSS -->
	<link href="../v3/vendors/bower_components/bootstrap-select/dist/css/bootstrap-select.min.css" rel="stylesheet" type="text/css"/>

  <link rel="stylesheet" href="../v3/vendors/bower_components/bootstrap-datepicker/bootstrap-datepicker3.min.css" />

  <!-- Bootstrap Switches CSS -->
	<link href="../v3/vendors/bower_components/bootstrap-switch/dist/css/bootstrap3/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
  <!-- vector map CSS -->
	<!-- <link href="../v3/vendors/bower_components/jquery-wizard.js/css/wizard.css" rel="stylesheet" type="text/css"/> -->

	<!-- jquery-steps css -->
	<!-- <link rel="stylesheet" href="../v3/vendors/bower_components/jquery.steps/demo/css/jquery.steps.css"> -->

	<!-- Custom CSS -->
	<link href="../v3/dist/css/style.css" rel="stylesheet" type="text/css">
  <link href="../v3/fonts.css" rel="stylesheet" type="text/css">
  <link href="../v3/style.css" rel="stylesheet" type="text/css">

</head>

<body>
	<!--Preloader-->
	<div class="preloader-it">
		<div class="la-anim-1"></div>
	</div>
	<!--/Preloader-->
    <div class="wrapper theme-1-active pimary-color-red">

        <!-- Top Menu Items -->
		<nav class="navbar navbar-inverse navbar-fixed-top">
			<div class="mobile-only-brand pull-left">
				<div class="nav-header pull-left">
					<div class="logo-wrap">
						<a href="./">
							<img class="brand-img" src="../v3/dist/img/logo.png" alt="brand"/>
							<span class="brand-text">RMIS</span>
						</a>
					</div>
				</div>
				<a id="toggle_nav_btn" class="toggle-left-nav-btn inline-block ml-20 pull-left" href="javascript:void(0);"><i class="zmdi zmdi-menu"></i></a>
				<a id="toggle_mobile_nav" class="mobile-only-view" href="javascript:void(0);"><i class="zmdi zmdi-more"></i></a>
			</div>
			<div id="mobile_only_nav" class="mobile-only-nav pull-right">
				<ul class="nav navbar-right top-nav pull-right">
          <li>
            <a href="profile.html">ยินดีต้อนรับ <span class="userFullname text-info">NA</span> (PI)</a>
          </li>


					<li class="dropdown alert-drp">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="zmdi zmdi-notifications top-nav-icon"></i><span class="notification_number"></span></a>
						<ul  class="dropdown-menu alert-dropdown" data-dropdown-in="bounceIn" data-dropdown-out="bounceOut">
							<li>
								<div class="notification-box-head-wrap">
									<span class="notification-box-head pull-left inline-block">การแจ้งเตือน</span>
									<a class="txt-danger pull-right clear-notifications inline-block" href="javascript:main.clear_notify()"> ล้างทั้งหมด </a>
									<div class="clearfix"></div>
									<hr class="light-grey-hr ma-0"/>
								</div>
							</li>
              <li>
                <div class="streamline message-nicescroll-bar notification_panal">
                </div>
              </li>
							<li>
								<div class="notification-box-bottom-wrap">
									<hr class="light-grey-hr ma-0"/>
									<a class="block text-center read-all" href="view_activity_log.html"> อ่านทั้งหมด </a>
									<div class="clearfix"></div>
								</div>
							</li>
						</ul>
					</li>

          <li class="dropdown auth-drp">
						<a href="#" class="dropdown-toggle pr-0" data-toggle="dropdown"><span id="profileImg"></span><span class="user-online-status"></span></a>
						<ul class="dropdown-menu user-auth-dropdown" data-dropdown-in="flipInX" data-dropdown-out="flipOutX">
							<li>
								<a href="profile.html"><i class="zmdi zmdi-account"></i><span>ข้อมูลส่วนตัว</span></a>
							</li>
							<li>
								<a href="#" onclick="main.inbox()"><i class="zmdi zmdi-email"></i><span>Inbox</span></a>
							</li>
							<li>
								<a href="changepassword.html"><i class="zmdi zmdi-settings"></i><span>เปลี่ยนรหัสผ่าน</span></a>
							</li>
							<li class="divider"></li>
							<li>
								<a href="#" onclick="main.signout()"><i class="zmdi zmdi-power"></i><span>ออกจากระบบ</span></a>
							</li>
						</ul>
					</li>


				</ul>
			</div>
		</nav>
		<!-- /Top Menu Items -->

		<!-- Left Sidebar Menu -->
		<div class="fixed-sidebar-left">
			<ul class="nav navbar-nav side-nav nicescroll-bar">
				<li class="navigation-header">
					<span>Main</span>
					<i class="zmdi zmdi-more"></i>
				</li>

        <li>
					<a href="./"><div class="pull-left"><i class="zmdi zmdi-home mr-20"></i><span class="right-nav-text">หน้าแรก</span></div><div class="clearfix"></div></a>
				</li>
        <li>
						<a href="javascript:void(0);" data-toggle="collapse" data-target="#dashboard_dr"><div class="pull-left"><i class="zmdi zmdi-landscape mr-20"></i><span class="right-nav-text">กระดานภาพรวม</span></div><div class="pull-right"><i class="zmdi zmdi-caret-down"></i></div><div class="clearfix"></div></a>
						<ul id="dashboard_dr" class="collapse collapse-level-1">
							<li>
								<a href="dashboard_1.html">ภาพรวมโครงการวิจัย</a>
							</li>
						</ul>
					</li>

				<li><hr class="light-grey-hr mb-10"/></li>
				<li class="navigation-header">
					<span>จัดการงานวิจัย</span>
					<i class="zmdi zmdi-more"></i>
				</li>
				<li>
					<a href="javascript:void(0);" data-toggle="collapse" data-target="#ui_dr"><div class="pull-left"><i class="zmdi zmdi-edit mr-20"></i><span class="right-nav-text">โครงการวิจัยใหม่</span></div><div class="pull-right"><i class="zmdi zmdi-caret-down"></i></div><div class="clearfix"></div></a>
					<ul id="ui_dr" class="collapse collapse-level-1 two-col-list">
						<li>
							<a data-toggle="modal" data-target="#myModal">ลงทะเบียนโครงการวิจัย (ใหม่)</a>
						</li>
            <li>
							<a href="research_unconf_list.html">โครงการวิจัยที่ยังไม่ยืนยันการส่ง</a>
						</li>
            <li>
							<a href="research_draft_list.html">แบบเสนอโครงการฉบับร่าง</a>
						</li>
						<li>
							<a href="research_reply_list.html">แบบเสนอโครงการที่รอแก้ไข</a>
						</li>
						<li>
							<a href="rs_list.html">โครงการวิจัยใหม่ทั้งหมด</a>
						</li>
					</ul>
				</li>

        <li>
					<a class="active" href="javascript:void(0);" data-toggle="collapse" data-target="#ui_dr2"><div class="pull-left"><i class="zmdi zmdi-flip-to-back mr-20"></i><span class="right-nav-text">โครงการวิจัยย้อนหลัง</span></div><div class="pull-right"><i class="zmdi zmdi-caret-down"></i></div><div class="clearfix"></div></a>
					<ul id="ui_dr2" class="collapse collapse-level-1 two-col-list">
						<li>
							<a class="active-page" href="../rs_add_back.php">ลงทะเบียนโครงการวิจัย (ย้อนหลัง)</a>
						</li>
						<li>
							<a href="../rs_back_list_nc.php">โครงการวิจัยที่ยังไม่ยืนยันการส่ง</a>
						</li>
						<li>
							<a href="../rs_back_list.php">โครงการวิจัยย้อนหลัง</a>
						</li>
					</ul>
				</li>

        <li>
					<a href="javascript:void(0);" data-toggle="collapse" data-target="#ui_dr3"><div class="pull-left"><i class="zmdi zmdi-8tracks mr-20"></i><span class="right-nav-text">โครงการกำลังดำเนินการ</span></div><div class="pull-right"><i class="zmdi zmdi-caret-down"></i></div><div class="clearfix"></div></a>
					<ul id="ui_dr3" class="collapse collapse-level-1 two-col-list">
            <li>
							<a href="goto_report_cont.html">โครงการที่อยู่ระหว่างการดำเนินการทั้งหมด</a>
						</li>
						<li>
							<a href="#" onclick="goto_report(1)">รายงานความก้าวหน้า (Progress report)</a>
						</li>
						<li>
							<a href="#" onclick="goto_report('2')" >ขอต่ออายุการรับรอง (Renewal)</a>
						</li>
						<li>
							<a href="#" onclick="goto_report('3')" >ขอปรับปรุงแก้ไขโครงการวิจัย (Amendment)</a>
						</li>
            <li>
							<a href="#" onclick="goto_report('4')" >รายงานเหตุการณ์ไม่พึงประสงค์ (SAE)</a>
						</li>
            <li>
							<a href="#" onclick="goto_report('5')" >รายงานการดำเนินงานที่เบี่ยงเบน (Deviation/Violation)</a>
						</li>
            <li>
							<a href="#" onclick="goto_report('6')" >รายงานการยุติ/สิ้นสุดโครการ (Termination/Closing)</a>
						</li>
            <li>
							<a href="goto_report_edit.html" >โครงการวิจัยที่ต้องแก้ไข</a>
						</li>
					</ul>
				</li>

				<li><hr class="light-grey-hr mb-10"/></li>
				<li class="navigation-header">
					<span>อื่น ๆ</span>
					<i class="zmdi zmdi-more"></i>
				</li>
				<li>
					<a href="javascript:void(0);" data-toggle="collapse" data-target="#pages_dr2"><div class="pull-left"><i class="zmdi zmdi-account mr-20"></i><span class="right-nav-text">ข้อมูลหัวหน้าโครงการ</span></div><div class="pull-right"><i class="zmdi zmdi-caret-down"></i></div><div class="clearfix"></div></a>
					<ul id="pages_dr2" class="collapse collapse-level-1 two-col-list">
						<li>
							<a href="../curriculum_vitae_add.php">Academic performance & CGP</a>
						</li>

            <li>
							<a href="../curriculum_vitae_list.php">การตีพิมพ์ผลงานวิจัย</a>
						</li>
					</ul>
				</li>

        <li>
					<a href="../rs_list_beforepayment.php"><div class="pull-left"><i class="zmdi zmdi-filter-list mr-20"></i><span class="right-nav-text">นำส่งเงินค่าธรรมเนียม</span></div><div class="clearfix"></div></a>
				</li>

        <li>
					<a href="documentation.html"><div class="pull-left"><i class="zmdi zmdi-book mr-20"></i><span class="right-nav-text">คู่มือการใช้งาน (PI)</span></div><div class="clearfix"></div></a>
				</li>

			</ul>
		</div>
		<!-- /Left Sidebar Menu -->


		<!-- Main Content -->
		<div class="page-wrapper" style="padding-left: 15px; padding-right: 15px;">
      <div class="container-fluid">

				<!-- Title -->
				<div class="row heading-bg">
					<div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">
						<h5 class="txt-dark">ลงทะเบียนเสนอโครงการวิจัยย้อนหลัง</h5>
					</div>
					<!-- Breadcrumb -->
					<div class="col-lg-9 col-sm-8 col-md-8 col-xs-12">
						<ol class="breadcrumb">
							<li><a href="./">หน้าแรก</a></li>
							<li class="active"><span>ลงทะเบียนเสนอโครงการวิจัยย้อนหลัง</span></li>
						</ol>
					</div>
					<!-- /Breadcrumb -->
				</div>
				<!-- /Title -->

        <!-- Row -->
        <div class="row">
          <div class="col-sm-12">
            <div class="panel panel-default card-view">

              <div class="panel-wrapper collapse in">
								<div class="panel-body">

                  <div class="loaddiv dn" style="padding: 100px 0px;">
                    <div class="row">
                      <div class="col-sm-2 col-sm-offset-5">
                        <img src="../images/Rolling.gif" alt="" width="100%">
                      </div>
                    </div>
                  </div>

                  <div class="contentdiv">

                    <form onsubmit="return false;">
                      <h4 class="pb-10">ตรวจสอบข้อมูลโครงการวิจัย</h4>

                      <div class="row mb-20">
                        <div class="col-sm-12 bg-success">
                          <div style="padding: 10px;">
                            <i class="zmdi zmdi-info-outline pr-15 pull-left"></i> ขั้นตอนนี้เป็นกระบวนการตรวจสอบว่าท่านเคยทำการลงทะเบียนโครงการดังกล่าวไว้ในระบบหรือไม่เท่านั้น หากตรวจพบว่าโครงการดังกล่าวยังไม่ได้รับการลงทะเบียน ให้ท่านบันทึกข้อมูลโครงการดังกล่าวให้สมบูรณ์ และรอเจ้าหน้าที่ตรวจสอบความถูกต้องก่อน จึงจะสามารถดำเนินการต่อในส่วนการรายงานอื่น ๆ ในส่วน Continuing ต่อไป
                          </div>
                        </div>
                      </div>

                      <div class="row">
                        <div class="col-sm-6 col-sm-offset-3">
                          <div class="form-group">
                            <label for="" class="txt-dark f500" >รหัส REC <span class="txt-danger">**</span></label>
                            <input type="text" class="form-control" placeholder="กรอกรหัส REC ที่ได้รับจากสำนักงาน ..." id="txtRec">
                            <p class="fs08 txt-danger">
                              <u>ตัวอย่าง</u> 60-012-01-01 เป็นต้น
                            </p>
                          </div>
                          <div class="form-group">
                            <div class="clearfix"></div>
                            <button class="btn btn-success btn-block" onclick="checkRec()"><i class="zmdi zmdi-search"></i> ตรวจสอบข้อมูล</button>
                          </div>
                        </div>
                      </div>

                    </form>

                  </div>
                  <!-- .contentdiv -->

                </div>
                <!-- .panel-body -->
              </div>
              <!-- .panel-wrapper -->
            </div>
            <!-- .panel -->



          </div>
          <!-- .col-sm-4 -->

        </div>
        <!-- .Row -->



				<!-- Footer -->
				<footer class="footer container-fluid pl-30 pr-30">
					<div class="row">
						<div class="col-sm-12">
							<p>2017 &copy; <a href="http://rmis.medicine.psu.ac.th/project/" target="_blank">RMIS</a>. หน่วยส่งเสริมและพัฒนาทางวิชาการ คณะแพทยศาสตร์ มหาวิทยาลัยสงขลานครินทร์. Develop by <a href="https://wisniorproject.com" target="_blank">Wisnior Corp.</a></p>
						</div>
					</div>
				</footer>
				<!-- /Footer -->
			</div>
		</div>
        <!-- /Main Content -->

    </div>
    <!-- /#wrapper -->

    <!-- sample modal content -->
    <div id="myModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header" style="background: #469408;">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
            <h5 class="modal-title txt-light f500" id="myModalLabel">ข้อตกลงและเงื่อนไข</h5>
          </div>
          <div class="modal-body">
            <p>
              <ol class="pl-20">
                <li>การลงทะเบียนส่วนนี้ หมายถึง <span class="txt-danger">การลงทะเบียนงานวิจัยที่ยังไม่ผ่านการรับรอง</span></li>
                <li>หากลงทะเบียนโครงการค้างอยู่ ให้ปิดกล่องข้อความนี้และเลือกปุ่ม "แบบเสนอโครงการฉบับร่าง"</li>
                <li>ผู้ลงข้อมูล<span class="txt-danger" style="font-size: 1.2em;">ต้องเป็นหัวหน้าโครงการเท่านั้น</span> (หัวหน้าโครงการเป็นผู้รับผิดชอบข้อมูลหากให้ผู้อื่นกระทำแทน) </li>
              </ol>
            </p>
            <p>
              ตอบ "ตกลง" เพื่อยอมรับเงื่อนไขและทำการลงทะเบียนงานวิจัยใหม่
            </p>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-success btn-block" onclick="window.location = 'research_register.html'">ตกลง</button>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->

    <button class="dn" id="btnNotify" data-toggle="modal" data-target=".bs-example-modal-sm" >notify</button>
    <!-- sample modal content -->
    <div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true" style="display: none;">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true" id="btnClosecheck">×</button>
            <h5 class="modal-title" id="mySmallModalLabel">การตรวจสอบข้อมูล</h5>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-sm-12 text-center">
                <div class="lp1 pt-50 pb-50">
                  <img src="../images/Rolling.gif" alt="" width="100"><br>
                  <span class="loadMsg"></span>
                </div>

                <div class="cp1 dn">
                  <p id="nofity_msg"></p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- /.modal-content -->
      </div>
      <!-- /.modal-dialog -->
    </div>
    <!-- /.modal -->

	<!-- JavaScript -->

  <!-- jQuery -->
  <script src="../v3/vendors/bower_components/jquery/dist/jquery.min.js"></script>

  <!-- Bootstrap Core JavaScript -->
  <script src="../v3/vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

	<!-- Data table JavaScript -->
	<script src="../v3/vendors/bower_components/datatables/media/js/jquery.dataTables.min.js"></script>
	<script src="../v3/dist/js/dataTables-data.js"></script>

	<!-- Slimscroll JavaScript -->
	<script src="../v3/dist/js/jquery.slimscroll.js"></script>

	<!-- Owl JavaScript -->
	<script src="../v3/vendors/bower_components/owl.carousel/dist/owl.carousel.min.js"></script>

	<!-- Switchery JavaScript -->
	<script src="../v3/vendors/bower_components/switchery/dist/switchery.min.js"></script>

	<!-- Fancy Dropdown JS -->
	<script src="../v3/dist/js/dropdown-bootstrap-extended.js"></script>

  <!-- Bootstrap Switch JavaScript -->
	<script src="../v3/vendors/bower_components/bootstrap-switch/dist/js/bootstrap-switch.min.js"></script>

  <!-- Select2 JavaScript -->
	<script src="../v3/vendors/bower_components/select2/dist/js/select2.full.min.js"></script>

  <!-- Bootstrap Tagsinput JavaScript -->
	<script src="../v3/vendors/bower_components/bootstrap-tagsinput/dist/bootstrap-tagsinput.min.js"></script>

	<!-- Bootstrap Touchspin JavaScript -->
	<script src="../v3/vendors/bower_components/bootstrap-touchspin/dist/jquery.bootstrap-touchspin.min.js"></script>

	<!-- Multiselect JavaScript -->
	<script src="../v3/vendors/bower_components/multiselect/js/jquery.multi-select.js"></script>

  <!-- Sweet-Alert  -->
	<script src="../v3/vendors/bower_components/sweetalert/dist/sweetalert.min.js"></script>

  <script src="../v3/vendors/bower_components/dropzonejs/dropzone.min.js"></script>

  <!-- Bootstrap Select JavaScript -->
	<script src="../v3/vendors/bower_components/bootstrap-select/dist/js/bootstrap-select.min.js"></script>

  <script src="../v3/vendors/bower_components/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
	<script src="../v3/vendors/bower_components/bootstrap-datepicker-thai-thai/js/bootstrap-datepicker-thai.js"></script>
	<script src="../v3/vendors/bower_components/bootstrap-datepicker-thai-thai/js/locales/bootstrap-datepicker.th.js"></script>

  <!-- Form Advance Init JavaScript -->
	<script src="../v3/dist/js/form-advance-data.js"></script>

  <script type="text/javascript" src="../v3/vendors/bower_components/ckeditor/ckeditor.js"></script>
	<!-- Init JavaScript -->
	<script src="../v3/dist/js/init.js"></script>
  <script src="../v3/main.js"></script>
  <script src="../v3/pi.js"></script>
  <!-- <script src="../v3/rs_register.js"></script> -->

  <script type="text/javascript">

    var dt = $('#tableView').dataTable().api();
    var current_user = window.localStorage.getItem('rmis_current_user')
    var current_role = window.localStorage.getItem('rmis_current_role')
    var log_login_session = window.localStorage.getItem('rmis_login_session_check');
    var current_page = 'research_register.html';
    var editData = '';
    var pi_pct = 100;
    var co_pi = [];
    var rr_notify = [];
    var num_file_upload = 0;
    var num_cv = 0;
    var session_id = main_app.randomString(20);
    var last_session_id = window.localStorage.getItem('rmis_current_rs_session_id');
    var selectes_session = window.localStorage.getItem('current_selected_project_session');
    var current_session_id = last_session_id;

    $(document).ready(function(){

      pi.init()




      $('.docSess').val(current_session_id)
      $('.docSessuser').val(current_user)

      // checkFileAttached();

      setTimeout(function(){
        main.load_notify_pm();
      }, 10)

    })

    function checkRec(){
      $('.form-group').removeClass('has-error')

      if($('#txtRec').val() == ''){
        $('#txtRec').parent().addClass('has-error')
        swal("ขออภัย!", "กรุณารอกเลข REC ที่ต้องการตรวจสอบ", "error")
        return ;
      }

      var rec = $('#txtRec').val().split('-')

      if(rec.length < 4){
        $('#txtRec').parent().addClass('has-error')
        swal("ขออภัย!", "รูปแบบรหัส REC ไม่ถูกต้อง กรุณาตรวจสอบจากตััวอย่าง", "error")
        return ;
      }

      lp.sl()

      var param = {
        searchRec: $('#txtRec').val(),
        id: current_user
      }

      var jxhr = $.post(ws_url + 'controller/check-rec-retro.php', param, function(){})
                  .always(function(resp){
                    // console.log(resp);
                    if(resp == 'Y'){
                      swal({    title: "ขออภัย",
                      text: "ไม่สามารถเพิ่มได้ เนื่องจากรหัสโครงการนี้ถูกบรรจุอยู่ในระบบแล้ว",
                      type: "warning",
                      showCancelButton: false,
                      confirmButtonColor: "#DD6B55",
                      confirmButtonText: "รับทราบ",
                      closeOnConfirm: true },
                      function(){
                        $('#txtRec').val('')
                        $('#txtRec').focus()
                      });
                    }
                    else if(resp == 'No apdu'){
                      swal({
                        title: "คำเตือน",
                        text: "ท่านสามารถเพิ่มข้อมูลโครงการดังกล่าวได้ ท่านยืนยันที่จะเพิ่มข้อมูลโครงการดังกล่าวหรือไม่",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "รับทราบ",
                        cancelButtonText: "ยกเลิก",
                        closeOnConfirm: true
                      },
                      function(){
                        window.localStorage.setItem('cuurent_rmis_code_apdu', $('#txtRec').val())
                        window.location = 'research_register_retroact.html'
                      });
                    }
                    lp.hl()
                  })
      return false;
    }

    $(function(){

      $('#txtBf1,#txtBf2,#txtBf3,#txtBf4,#txtBf5,#txtBf7').blur(function(){
        saveDraftCheck()
      })

      $('#txtBf1,#txtBf2,#txtBf3,#txtBf4,#txtBf5,#txtBf7').keyup(function(){
        sumBudget()
      })



      $('#saveAllBtn').click(function(){

        rr_notify = [];
        rr_form.part1()
        rr_form.part2()
        rr_form.part3()
        rr_form.part4()
        rr_form.part5()

        $('.loadMsg').text('กำลังทำการตรวจสอบ ...')

        $('#btnNotify').trigger('click');

        if(rr_notify.length > 0){

        }else{
          setTimeout(function(){
            $('.loadMsg').text('กำลังทำการบันทึกข้อมูล ...')

            var param = {
              id: current_user,
              sess_id: current_session_id
            }

            var jxhr = $.post(ws_url + 'controller/pm/set_undraft.php', param, function(){})
                        .always(function(resp){
                          if(resp == 'Y'){

                            window.localStorage.setItem('current_selected_project_session', current_session_id)
                            window.location = 'research_info.html'

                          }else if(resp == 'D'){
                            setTimeout(function(){
                              $('#btnClosecheck').trigger('click');
                              swal("ขออภัย!", "ระบบตรวจพบว่าท่านเคยมีโครงการที่มีชื่อคล้ายกัน (Similariry > 90%) ส่งไปยังสำนักงานจริยธรรมการวิจัยในมนุษย์แล้ว กรุณาทำการตรวจสอบข้อมูลอีกครั้ง หรือติดต่อเจ้าหน้าที่หากท่านยืนยันว่าข้อมูลนี้เป็นโครงการคนละชุดกัน", "error")
                            }, 2000)
                          }else{
                            setTimeout(function(){
                              $('#btnClosecheck').trigger('click');
                              swal("ขออภัย!", "ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง หรือติดต่อเจ้าหน้าที่", "error")
                            }, 2000)
                          }
                        })
                        .fail(function(){
                          setTimeout(function(){
                            $('#btnClosecheck').trigger('click');
                            swal("ขออภัย!", "ไม่สามารถบันทึกข้อมูลได้ กรุณาลองใหม่อีกครั้ง หรือติดต่อเจ้าหน้าที่", "error")
                          }, 2000)
                        })

          }, 2000)


        }

      });

      $('#txtFund').change(function(){
        if($('#txtFund').val()==0){
          $('.fundDiv').addClass('dn')
          if($("#cb1").is(':checked')){
            $("#cb1").trigger('click')
          }

          if($("#cb2").is(':checked')){
            $("#cb2").trigger('click')
          }

          if($("#cb3").is(':checked')){
            $("#cb3").trigger('click')
          }

          if($("#cb4").is(':checked')){
            $("#cb4").trigger('click')
          }

          if($("#cb5").is(':checked')){
            $("#cb5").trigger('click')
          }

          if($("#cb6").is(':checked')){
            $("#cb6").trigger('click')
          }

          if($("#cb7").is(':checked')){
            $("#cb7").trigger('click')
          }

          $('#txtFundsname').val('')
        }else{
          $('.fundDiv').removeClass('dn')
        }
      })

      $('.cpwdform').submit(function(){
          if($('#txtNewpwd').val()==''){
            swal("ขออภัย", "กรุณาตั้งรหัสผ่านใหม่ก่อนดำเนินการ", "error")
            return ;
          }

          var newPwd = $('#txtNewpwd').val();
          if(newPwd.length < 8){
            swal("ขออภัย", "กรุณาตั้งรหัสผ่านอย่างน้อย 8 ตัวอักษร", "error")
            return ;
          }

          $('.loaddiv').removeClass('dn')
          $('.contentdiv').addClass('dn')

          main.changepassword();
      })

      $('.partTab, #recheckBtn').click(function(){
        rr_notify = [];
        num_file_upload = 0;
        rr_form.part1()
        rr_form.part2()
        rr_form.part3()
        rr_form.part4()
        rr_form.part5()
        rr_form.fn_summary()
        saveDraftCheck()
        saveCopi();
      })

      $('#cb6').click(function(){
        if($("#cb6").is(':checked')){
          $("#otherfunding").removeClass('dn');  // checked
        }
        else{
          $("#otherfunding").addClass('dn');  // checked
          $('#txtOtherFundSource').val('')
        }
      });

    })

    function addCoPI(){
      $check = 0;
      if($('#copi_preifx').val()==''){
        $check++;
      }

      if($('#copi_fname').val()==''){
        $check++;
      }

      if($('#copi_lname').val()==''){
        $check++;
      }

      if($('#copi_email').val()==''){
        $check++;
      }

      if($('#copi_pct').val()==''){
        $check++;
      }

      if($('#repot').val()==''){
        $check++;
      }

      if($check!=0){
        swal("ขออภัย!", "กรุณากรอกข้อมูลให้คนบถ้วนก่อนการเพิ่มผู้ร่วมวิจัย", "error")
        return ;
      }

      var lat_co_pct = pi_pct - parseInt($('#copi_pct').val());

      if(lat_co_pct < 0){
        swal("ขออภัย!", "สัดส่วนรวมไม่เกิน 100%", "error")
        return ;
      }

      pi_pct = lat_co_pct;
      $('#pi_cpt').val(lat_co_pct)

      var copi_record = {
        prefix: $('#copi_prefix').val(),
        prefix_name: $('#copi_prefix option:selected').text(),
        fname: $('#copi_fname').val(),
        lname: $('#copi_lname').val(),
        email: $('#copi_email').val(),
        pct: $('#copi_pct').val(),
        repot: $('#repot').val(),
        session_id: current_session_id,
        id: current_user
      }

      var jxhr = $.post(ws_url + 'controller/pm/save_co_pi.php', copi_record, function(){}, '')
                  .always(function(resp){
                    if(resp != 'Y'){
                      alert('ไม่สามารถบันทึกข้อมูลได้')
                      console.log(resp);
                    }else{
                      co_pi.push(copi_record)

                      $('#copi_prefix').val('')
                      $('#copi_fname').val('')
                      $('#copi_lname').val('')
                      $('#copi_email').val('')
                      $('#copi_pct').val('')
                      $('#repot').val('');
                      $('#copi_prefix').focus();

                      listCopi();
                    }
                  })





    }

    function checkPart(pid){
      if(pid == 5){
        $('#saveAllBtn').removeClass('dn')
      }else{
        $('#saveAllBtn').addClass('dn')
      }
    }



    function saveDraft(){
      saveDraftCheck()
    }

    function reloadD(){

      rr_notify = [];
      rr_form.part1()
      rr_form.part2()
      rr_form.part3()
      rr_form.part4()
      rr_form.part5()
      rr_form.fn_summary()

    }

    function saveCopi(){
      if(co_pi.length != 0){

      }
    }

    function goto_report(progress_id){
      window.localStorage.setItem('rmis_current_progress_id', progress_id)
      window.location = 'create_report.html'
    }
  </script>
</body>

</html>
