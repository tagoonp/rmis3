<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv='cache-control' content='no-cache'>
  <meta http-equiv='expires' content='0'>
  <meta http-equiv='pragma' content='no-cache'>
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	<title>:: RMIS :: สำหรับหัวหน้าโครงการ ::</title>

	<!-- Data table CSS -->
	<link href="../v3/vendors/bower_components/datatables/media/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css"/>

  <!--alerts CSS -->
	<link href="../v3/vendors/bower_components/sweetalert/dist/sweetalert.css" rel="stylesheet" type="text/css">

	<!-- Custom CSS -->
	<link href="../v3/dist/css/style.css" rel="stylesheet" type="text/css">
  <link href="../v3/fonts.css" rel="stylesheet" type="text/css">
  <link href="../v3/style.css" rel="stylesheet" type="text/css">

</head>

<body>
	<!--Preloader-->
	<div class="preloader-it">
		<div class="la-anim-1"></div>
	</div>
	<!--/Preloader-->
    <div class="wrapper theme-1-active pimary-color-red">

        <!-- Top Menu Items -->
		<nav class="navbar navbar-inverse navbar-fixed-top">
			<div class="mobile-only-brand pull-left">
				<div class="nav-header pull-left">
					<div class="logo-wrap">
						<a href="index.html">
							<img class="brand-img" src="../v3/dist/img/logo.png" alt="brand"/>
							<span class="brand-text">RMIS</span>
						</a>
					</div>
				</div>
				<a id="toggle_nav_btn" class="toggle-left-nav-btn inline-block ml-20 pull-left" href="javascript:void(0);"><i class="zmdi zmdi-menu"></i></a>
				<a id="toggle_mobile_nav" class="mobile-only-view" href="javascript:void(0);"><i class="zmdi zmdi-more"></i></a>
			</div>
			<div id="mobile_only_nav" class="mobile-only-nav pull-right">
				<ul class="nav navbar-right top-nav pull-right">
          <li>
            <a href="profile.html">ยินดีต้อนรับ <span class="userFullname text-info">NA</span> (STAFF)</a>
          </li>
					<li class="dropdown alert-drp">
						<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="zmdi zmdi-notifications top-nav-icon"></i><span class="notification_number"></span></a>
						<ul  class="dropdown-menu alert-dropdown" data-dropdown-in="bounceIn" data-dropdown-out="bounceOut">
							<li>
								<div class="notification-box-head-wrap">
									<span class="notification-box-head pull-left inline-block">การแจ้งเตือน</span>
									<a class="txt-danger pull-right clear-notifications inline-block" href="javascript:main.clear_notify()"> ล้างทั้งหมด </a>
									<div class="clearfix"></div>
									<hr class="light-grey-hr ma-0"/>
								</div>
							</li>
              <li>
                <div class="streamline message-nicescroll-bar notification_panal">
                </div>
              </li>
							<li>
								<div class="notification-box-bottom-wrap">
									<hr class="light-grey-hr ma-0"/>
									<a class="block text-center read-all" href="view_activity_log.html"> อ่านทั้งหมด </a>
									<div class="clearfix"></div>
								</div>
							</li>
						</ul>
					</li>
          <li class="dropdown auth-drp">
						<a href="#" class="dropdown-toggle pr-0" data-toggle="dropdown"><span id="profileImg"></span><span class="user-online-status"></span></a>
						<ul class="dropdown-menu user-auth-dropdown" data-dropdown-in="flipInX" data-dropdown-out="flipOutX">
							<li>
								<a href="profile.html"><i class="zmdi zmdi-account"></i><span>ข้อมูลส่วนตัว</span></a>
							</li>
							<li>
								<a href="#" onclick="main.inbox()"><i class="zmdi zmdi-email"></i><span>Inbox</span></a>
							</li>
							<li>
								<a href="changepassword.html"><i class="zmdi zmdi-settings"></i><span>เปลี่ยนรหัสผ่าน</span></a>
							</li>
							<li class="divider"></li>
							<li>
								<a href="#" onclick="main.signout()"><i class="zmdi zmdi-power"></i><span>ออกจากระบบ</span></a>
							</li>
						</ul>
					</li>
				</ul>
			</div>
		</nav>
		<!-- /Top Menu Items -->

		<!-- Left Sidebar Menu -->
		<div class="fixed-sidebar-left">
			<ul class="nav navbar-nav side-nav nicescroll-bar">
				<li class="navigation-header">
					<span>Main</span>
					<i class="zmdi zmdi-more"></i>
				</li>

        <li>
					<a href="./"><div class="pull-left"><i class="zmdi zmdi-home mr-20"></i><span class="right-nav-text">หน้าแรก</span></div><div class="clearfix"></div></a>
				</li>
        <li>
						<a href="javascript:void(0);" data-toggle="collapse" data-target="#dashboard_dr"><div class="pull-left"><i class="zmdi zmdi-landscape mr-20"></i><span class="right-nav-text">กระดานภาพรวม</span></div><div class="pull-right"><i class="zmdi zmdi-caret-down"></i></div><div class="clearfix"></div></a>
						<ul id="dashboard_dr" class="collapse collapse-level-1">
							<li>
								<a href="dashboard_1.html">ภาพรวมโครงการวิจัย</a>
							</li>
						</ul>
					</li>

				<li><hr class="light-grey-hr mb-10"/></li>
				<li class="navigation-header">
					<span>จัดการงานวิจัย</span>
					<i class="zmdi zmdi-more"></i>
				</li>
				<li>
					<a href="javascript:void(0);" data-toggle="collapse" data-target="#ui_dr"><div class="pull-left"><i class="zmdi zmdi-edit mr-20"></i><span class="right-nav-text">โครงการวิจัยใหม่</span></div><div class="pull-right"><i class="zmdi zmdi-caret-down"></i></div><div class="clearfix"></div></a>
					<ul id="ui_dr" class="collapse collapse-level-1 two-col-list">
						<li>
							<a href="#" data-toggle="modal" data-target="#myModal">ลงทะเบียนโครงการวิจัย (ใหม่)</a>
						</li>
            <li>
							<a href="research_unconf_list.html">โครงการวิจัยที่ยังไม่ยืนยันการส่ง</a>
						</li>
            <li>
							<a href="research_draft_list.html">แบบเสนอโครงการฉบับร่าง</a>
						</li>
						<li>
							<a href="research_reply_list.html">แบบเสนอโครงการที่รอแก้ไข</a>
						</li>
						<li>
							<a href="rs_list.html">โครงการวิจัยใหม่ทั้งหมด</a>
						</li>
					</ul>
				</li>

        <li>
					<a href="javascript:void(0);" data-toggle="collapse" data-target="#ui_dr2"><div class="pull-left"><i class="zmdi zmdi-flip-to-back mr-20"></i><span class="right-nav-text">โครงการวิจัยย้อนหลัง</span></div><div class="pull-right"><i class="zmdi zmdi-caret-down"></i></div><div class="clearfix"></div></a>
					<ul id="ui_dr2" class="collapse collapse-level-1 two-col-list">
						<li>
							<a href="../rs_add_back.php">ลงทะเบียนโครงการวิจัย (ย้อนหลัง)</a>
						</li>
						<li>
							<a href="../rs_back_list_nc.php">โครงการวิจัยที่ยังไม่ยืนยันการส่ง</a>
						</li>
						<li>
							<a href="../rs_back_list.php">โครงการวิจัยย้อนหลัง</a>
						</li>
					</ul>
				</li>

        <li>
					<a href="javascript:void(0);" data-toggle="collapse" data-target="#ui_dr3"><div class="pull-left"><i class="zmdi zmdi-8tracks mr-20"></i><span class="right-nav-text">โครงการกำลังดำเนินการ</span></div><div class="pull-right"><i class="zmdi zmdi-caret-down"></i></div><div class="clearfix"></div></a>
					<ul id="ui_dr3" class="collapse collapse-level-1 two-col-list">
            <li>
							<a href="goto_report_cont.html">โครงการที่อยู่ระหว่างการดำเนินการทั้งหมด</a>
						</li>
						<li>
							<a href="#" onclick="goto_report(1)">รายงานความก้าวหน้า (Progress report)</a>
						</li>
						<li>
							<a href="#" onclick="goto_report('2')" >ขอต่ออายุการรับรอง (Renewal)</a>
						</li>
						<li>
							<a href="#" onclick="goto_report('3')" >ขอปรับปรุงแก้ไขโครงการวิจัย (Amendment)</a>
						</li>
            <li>
							<a href="#" onclick="goto_report('4')" >รายงานเหตุการณ์ไม่พึงประสงค์ (SAE)</a>
						</li>
            <li>
							<a href="#" onclick="goto_report('5')" >รายงานการดำเนินงานที่เบี่ยงเบน (Deviation/Violation)</a>
						</li>
            <li>
							<a href="#" onclick="goto_report('6')" >รายงานการยุติ/สิ้นสุดโครการ (Termination/Closing)</a>
						</li>
            <li>
							<a href="goto_report_edit.html" >โครงการวิจัยที่ต้องแก้ไข</a>
						</li>
					</ul>
				</li>

				<li><hr class="light-grey-hr mb-10"/></li>
				<li class="navigation-header">
					<span>อื่น ๆ</span>
					<i class="zmdi zmdi-more"></i>
				</li>
				<li>
					<a href="javascript:void(0);" data-toggle="collapse" data-target="#pages_dr2"><div class="pull-left"><i class="zmdi zmdi-account mr-20"></i><span class="right-nav-text">ข้อมูลหัวหน้าโครงการ</span></div><div class="pull-right"><i class="zmdi zmdi-caret-down"></i></div><div class="clearfix"></div></a>
					<ul id="pages_dr2" class="collapse collapse-level-1 two-col-list">
						<li>
							<a href="../curriculum_vitae_add.php">Academic performance & CGP</a>
						</li>

            <li>
							<a href="../curriculum_vitae_list.php">การตีพิมพ์ผลงานวิจัย</a>
						</li>
					</ul>
				</li>

        <li>
					<a href="../rs_list_beforepayment.php"><div class="pull-left"><i class="zmdi zmdi-filter-list mr-20"></i><span class="right-nav-text">นำส่งเงินค่าธรรมเนียม</span></div><div class="clearfix"></div></a>
				</li>

        <li>
					<a href="documentation.html"><div class="pull-left"><i class="zmdi zmdi-book mr-20"></i><span class="right-nav-text">คู่มือการใช้งาน (PI)</span></div><div class="clearfix"></div></a>
				</li>

			</ul>
		</div>
		<!-- /Left Sidebar Menu -->


		<!-- Main Content -->
		<div class="page-wrapper" style="padding-left: 15px; padding-right: 15px;">
      <div class="container-fluid">

				<!-- Title -->
				<div class="row heading-bg mb-0">
					<div class="col-sm-6 col-xs-12">
						<h5 class="txt-dark">ข้อมูลการรายงาน</h5>
					</div>
					<!-- Breadcrumb -->
					<div class="col-sm-6 col-xs-12">
						<ol class="breadcrumb">
							<li><a href="./">หน้าแรก</a></li>
							<li class="active"><span>ข้อมูลการรายงาน</span></li>
						</ol>
					</div>
					<!-- /Breadcrumb -->
				</div>
				<!-- /Title -->

        <!-- Row -->
        <div class="row">
          <div class="col-sm-12">
            <div class="row">
              <div class="col-sm-6 pl-10 pr-10 pb-10 pt-0 hidden-xs">
                <button class="btn btn-default btn-icon-anim btn-square" onclick="window.history.back()"><i class="zmdi zmdi-chevron-left"></i></button>
              </div>
              <div class="col-sm-6 col-xs-12 pl-10 pr-10 pb-10 pt-0 text-right">
                <button class="btn btn-success btn-icon-anim btn-square" id="btnEdit" onclick="window.location = 'progress5_1_update.html'"><i class="zmdi zmdi-wrench"></i></button>
                <button class="btn btn-success btn-icon-anim btn-square" disabled onclick="printForm('printArea')" id="btnPrint"><i class="zmdi zmdi-print"></i></button>
                <button class="btn btn-info" onclick="sendProgressData()" id="btnSending"><i class="zmdi zmdi-mail-send"></i> ยืนยันส่งข้อมูล</button>
              </div>
            </div>
            <div class="panel panel-default card-view">

              <div class="panel-wrapper collapse in">
								<div class="panel-body">

                  <div class="loaddiv" style="padding: 100px 0px;">
                    <div class="row">
                      <div class="col-sm-2 col-sm-offset-5">
                        <img src="../images/Rolling.gif" alt="" width="100%">
                      </div>
                    </div>
                  </div>

                  <div class="contentdiv dn">
                    <div class="row">

                      <div class="col-sm-12">
                        <div  class="pills-struct mt-0">
      										<ul role="tablist" class="nav nav-pills" id="myTabs_6">
      											<li class="active" role="presentation"><a aria-expanded="true"  data-toggle="tab" role="tab" id="home_tab_6" href="#home_6">แบบฟอร์มการรายงาน</a></li>
                            <li role="presentation" class=""><a  data-toggle="tab" id="profile_tab_7" role="tab" href="#profile_7 " aria-expanded="false">ดำเนินการ</a></li>
      											</li>
      										</ul>
      										<div class="tab-content" id="myTabContent_6">
      											<div  id="home_6" class="tab-pane fade active in" role="tabpanel">
      												<div class="main_progress_report_form">กำลังดาวน์โหลด ...</div>
      											</div>
                            <div  id="profile_7" class="tab-pane fade" role="tabpanel">
      												<div class="pl-10 pr-10">
                                <div class="form-group">
                                  <label for="" class="txt-dark f500">ผลการตรวจสอบเอกสาร <span class="txt-danger">**</span></label>
                                  <select class="form-control" name="txtDocresult" id="txtDocresult">
                                    <option value="">--- เลือกผลการตรวจสอบ ---</option>
                                    <option value="1">เอกสารถูกต้อง เสนอเลขาเพื่อพิจารณาผู้เชี่ยวชาญอิสระ</option>
                                    <option value="2">เอกสารไม่ถูกต้อง</option>
                                  </select>
                                </div>

                                <div class="dnc dn">
                                  <div class="form-group">
                                    <label for="txt-dark f500">ข้อความส่งถึงผู้วิจัย <span class="txt-danger">**</span></label>
                                    <textarea name="textarea1" id="textarea1" rows="8" cols="80"></textarea>
                                  </div>

                                  <div class="row">
                                    <div class="col-sm-6">
                                      <div class="form-group">
                                        <label for="txt-dark f500">ชื่อผู้วิจัย <span class="txt-danger">**</span></label>
                                        <input type="text" class="form-control" id="txtPiname" readonly>
                                      </div>
                                    </div>
                                    <div class="col-sm-6">
                                      <div class="form-group">
                                        <label for="txt-dark f500">E-mail <span class="txt-danger">**</span></label>
                                        <input type="text" class="form-control" id="txtPiemail" readonly>
                                      </div>
                                    </div>
                                  </div>

                                  <div class="row">
                                    <div class="col-sm-12">
                                      <button class="btn btn-success btn-block" onclick="sendNotcorrent()">บันทึกและส่ง</button>
                                    </div>
                                  </div>

                                </div>

                                <div class="dc dn">
                                  <div class="form-group">
                                    <label for="" class="f500 txt-dark">ส่งต่อเลขา ฯ <span class="txt-danger">**</span></label>
                                    <select class="form-control" name="txtEC" id="txtEC">
                                      <option value="">-- กรุณาเลือกเลขา EC --</option>
                                    </select>
                                  </div>

                                  <div class="row">
                                    <div class="col-sm-6">
                                      <div class="form-group">
                                        <label for="txt-dark f500">ชื่อเลขา <span class="txt-danger">**</span></label>
                                        <input type="text" class="form-control" id="txtECname" readonly placeholder="เลือกเลขา EC ก่อน ...">
                                      </div>
                                    </div>
                                    <div class="col-sm-6">
                                      <div class="form-group">
                                        <label for="txt-dark f500">E-mail เลขา <span class="txt-danger">**</span></label>
                                        <input type="text" class="form-control" id="txtECemail" readonly placeholder="เลือกเลขา EC ก่อน ...">
                                      </div>
                                    </div>
                                  </div>

                                  <div class="form-group">
                                    <label for="txt-dark f500">ข้อความส่งถึงเลขา <span class="txt-danger">**</span></label>
                                    <textarea name="textarea2" id="textarea2" rows="8" cols="80"></textarea>
                                  </div>



                                  <div class="row">
                                    <div class="col-sm-12">
                                      <button class="btn btn-success btn-block" onclick="sendCorrent()">บันทึกและส่ง</button>
                                    </div>
                                  </div>


                                </div>

                              </div>
      											</div>
      										</div>
      									</div>
                      </div>


                    </div>
                  </div>
                  <!-- .contentdiv -->



                </div>
                <!-- .panel-body -->
              </div>
              <!-- .panel-wrapper -->
            </div>
            <!-- .panel -->



          </div>
          <!-- .col-sm-4 -->

        </div>
        <!-- .Row -->


				<!-- Footer -->
				<footer class="footer container-fluid pl-30 pr-30">
					<div class="row">
						<div class="col-sm-12">
							<p>2017 &copy; <a href="http://rmis.medicine.psu.ac.th/project/" target="_blank">RMIS</a>. หน่วยส่งเสริมและพัฒนาทางวิชาการ คณะแพทยศาสตร์ มหาวิทยาลัยสงขลานครินทร์. Develop by <a href="https://wisniorproject.com" target="_blank">Wisnior Corp.</a></p>
						</div>
					</div>
				</footer>
				<!-- /Footer -->
			</div>
		</div>
        <!-- /Main Content -->

    </div>
    <!-- /#wrapper -->

	<!-- JavaScript -->

  <!-- jQuery -->
  <script src="../v3/vendors/bower_components/jquery/dist/jquery.min.js"></script>

  <!-- Bootstrap Core JavaScript -->
  <script src="../v3/vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

	<!-- Data table JavaScript -->
	<script src="../v3/vendors/bower_components/datatables/media/js/jquery.dataTables.min.js"></script>
	<script src="../v3/dist/js/dataTables-data.js"></script>

	<!-- Slimscroll JavaScript -->
	<script src="../v3/dist/js/jquery.slimscroll.js"></script>

	<!-- Owl JavaScript -->
	<script src="../v3/vendors/bower_components/owl.carousel/dist/owl.carousel.min.js"></script>

	<!-- Switchery JavaScript -->
	<script src="../v3/vendors/bower_components/switchery/dist/switchery.min.js"></script>

	<!-- Fancy Dropdown JS -->
	<script src="../v3/dist/js/dropdown-bootstrap-extended.js"></script>

  <!-- Sweet-Alert  -->
	<script src="../v3/vendors/bower_components/sweetalert/dist/sweetalert.min.js"></script>

  <script type="text/javascript" src="../v3/vendors/bower_components/ckeditor_lite/ckeditor.js"></script>

	<!-- Init JavaScript -->
	<script src="../v3/dist/js/init.js"></script>
  <script src="../v3/main.js"></script>
  <script src="../v3/staff.js"></script>
  <script src="../v3/progress.js"></script>

  <script type="text/javascript">

    var dt = $('#tableView').dataTable().api();
    var current_user = window.localStorage.getItem('rmis_current_user')
    var current_role = window.localStorage.getItem('rmis_current_role')
    var current_pid = window.localStorage.getItem('current_progress_id')
    var current_prpgress = window.localStorage.getItem('current_progress')
    var editData = '';
    var editData2 = '';

    editData = CKEDITOR.replace( 'textarea1', {
      wordcount : {
        showCharCount : false,
        showWordCount : true
      },
      height: '200px'
    });

    editData2 = CKEDITOR.replace( 'textarea2', {
      wordcount : {
        showCharCount : false,
        showWordCount : true
      },
      height: '200px'
    });

    $(document).ready(function(){

      if(current_pid == null){
        swal({      title: "เกิดข้อผิดพลาด",
                    text: "ไม่พบข้อมูลงานวิจัยที่ต้องการ กรุณาลองใหม่ หรือติดต่อเจ้าหน้าที่!",
                    type: "error",
                    showCancelButton: false,
                    confirmButtonColor: "#DD6B55",
                    confirmButtonText: "รับทราบ",
                    closeOnConfirm: false },
                    function(){
                     window.location = './'
                    });
      }

      staff.load_ec_list();

      var url = null;
      if(current_prpgress == 5){
        url = 'pg_5_1_form.html'
      }else if(current_prpgress == 6){
        url = 'pg_5_2_form.html'
      }

      var jxhr = $.post(url, function(){})
                  .always(function(resp){
                    $('.main_progress_report_form').html(resp)
                    setTimeout(function(){
                      staff.init()
                      if(current_prpgress == 5){
                        load_progress_info_5();
                      }else if(current_prpgress == 6){
                        load_progress_info_6();
                      }

                    }, 2000)
                  })






    })

    $(function(){

      $('#txtEC').change(function(){
        if($('#txtEC').val() != ''){
            var param = {
              id_ec : $('#txtEC').val()
            }

            var jxhr = $.post(ws_url + 'controller/get_ec_info.php', param, function(){}, 'json')
                        .always(function(snap){
                          $('#txtECname').val('')
                          $('#txtECemail').val('')
                          if((snap != '') && (snap.length > 0)){
                              snap.forEach(function(i){
                                $('#txtECname').val(i.fname + ' ' + i.lname)
                                $('#txtECemail').val(i.email)
                              })
                          }
                        }, 'json')
        }
      })

      $('#txtDocresult').change(function(){
        if($('#txtDocresult').val() == '1'){
          $('.dnc').addClass('dn')
          $('.dc').removeClass('dn')
        }else if($('#txtDocresult').val() == '2'){
          $('.dnc').removeClass('dn')
          $('.dc').addClass('dn')
        }else{
          $('.dnc').addClass('dn')
          $('.dc').addClass('dn')
        }
      })

      $('.cpwdform').submit(function(){
          if($('#txtNewpwd').val()==''){
            swal("ขออภัย", "กรุณาตั้งรหัสผ่านใหม่ก่อนดำเนินการ", "error")
            return ;
          }

          var newPwd = $('#txtNewpwd').val();
          if(newPwd.length < 8){
            swal("ขออภัย", "กรุณาตั้งรหัสผ่านอย่างน้อย 8 ตัวอักษร", "error")
            return ;
          }

          $('.loaddiv').removeClass('dn')
          $('.contentdiv').addClass('dn')

          main.changepassword();
      })
    })

    function sendData(){
      swal({
        title: "คำเตือน",
        text: "คุณยืนยันที่จะส่งข้อมูลไปยังเจ้าหน้าที่หรือไม่ เนื่องจากหลังท่านทำการยืนยันการส่งข้อมูลแล้ว ท่านจะไม่สามารถแก้ไขข้อมูลได้จนกว่าจะได้รับการตอบกลับจากเจ้าหน้าที่",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#DD6B55",
        confirmButtonText: "ยืนยันการส่ง",
        cancelButtonText: "ยกเลิก",
        closeOnConfirm: false
      },
      function(){

        lp.sl()

        var param = {
          id: current_user,
          sess_id: current_project_session
        }

        var jxhr = $.post(ws_url + 'controller/pm/pm-confirm-sending.php', param, function(){})
                    .always(function(resp){

                      if(resp == 'Y'){

                        var dataContent = '<h3>ข้อมูลการลงทะเบียนโครงการวิจัยเพื่อขอพิจารณาจริยธรรมการทำวิจัยในมนุษย์</h3>' +
                                          '<p>เรียน ' + $('.userFullname').text() + '</p>' +
                                          '<p>ท่านได้ทำการลงทะเบียนโครงการวิจัยเพื่อขอพิจารณาจริยธรรมการทำวิจัยในมนุษย์ผ่านระบบสารสนเทศเพื่อการจัดการงานวิจัย (RMIS) ไว้นั้น ภายใต้ชื่อโครงการ ' + $('#txtThtitle').text() + ' เรียบร้อยแล้ว ทั้งนี้ ท่านสามารถเข้าสู่ระบบเพื่อตรวจสอบความคืบหน้าของกระบวนการต่อไป' +
                                          '</p>' +
                                          '<p>จึงเรียนมาเพื่อทราบ <br>ระบบสารสนเทศเพื่อการจัดการงานวิจัย (RMIS)</p>'

                        var emailParam = {
                          email: emailConfig.user,
                          api_key: emailConfig.key,
                          title: "{ No-reply } ข้อมูลการลงทะเบียนโครงการวิจัยเพื่อขอพิจารณาจริยธรรมการทำวิจัยในมนุษย์",
                          to_email: window.localStorage.getItem('rmis_current_user_email'),
                          content: dataContent
                        }
                        var jxhr = $.post(emailProvider, emailParam, function(){})
                                    .always(function(res){
                                      if(res!='Y'){}
                                    })

                        swal({   title: "ส่งข้อมูลสำเร็จ",
                          text: "ข้อมูลส่งเรียบร้อยแล้ว กรุณารอการติดต่อกลับจากเจ้าหน้าที่",
                          type: "success",
                          showCancelButton: true,
                          confirmButtonColor: "#DD6B55",
                          confirmButtonText: "รับทราบ",
                          cancelButtonText: "กลับสู่หน้าแรก",
                          closeOnConfirm: false,
                          closeOnCancel: false },
                          function(isConfirm){
                              if (isConfirm) {
                                window.location = 'research_info_waitprint.html'
                              }
                              else {
                                window.localStorage.removeItem(current_project_session)
                                window.location = './';
                              }
                         });
                      }else{
                        swal("ขออภัย", "ไม่สามารถทำการส่งข้อมูลได้ กรุณาติดต่อเจ้าหน้าที่", "error")
                        lp.hl()
                      }
                    })
                    .fail(function(){
                      swal("ขออภัย", "ไม่สามารถเชื่อมต่อฐานข้อมูลได้ กรุณาลองใหม่ภายหลัง", "error")
                      lp.hl()
                    })

      });

    }

    function sendNotcorrent(){
      var information = editData.getData()
      if(information == ''){
        swal("ขออภัย!", "กรุณากรอกข้อความที่จะส่งถึงผู้วิจัยให้ครบถ้วน!", "error")
        return ;
      }

      swal({
        title: "ยืนยันการดำเนินการ",
        text: "คุฯยืนยันส่งข้อมูลเหล่านี้ไปยังผู้วิจัยหรือไม่!",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#DD6B55",
        confirmButtonText: "ยืนยัน",
        cancelButtonText: "ยกเลิก",
        closeOnConfirm: true
      },
      function(){
        var param  = {
          rp_id: current_pid,
          user: current_user,
          info: information
        }

        lp.sl();

        var jxhr = $.post(ws_url + 'controller/staff/update_continuing_stop1.php', param ,function(){})
                    .always(function(resp){
                      // console.log(resp);
                        if(resp == 'Y'){
                          $rc = $('#txt-rec').text();

                          var dataContent = '<h3>ผลการตรวจสอบความถูกต้องของเอกสารการรายงาน' + $('#ptype').text() +' </h3>' +

                                            '<p style="font-size: 1.3em;"><strong>รหัสโครงการของท่าน คือ <span style="color: red;">REC.' + $rc + '</span></strong><br><strong>รหัสโครงการรายงาน คือ <span style="color: red;">REF. ' + $('#txt-ref').text() + '</span></strong></p>' +
                                            '<p><strong>ชื่อโครงการ (ภาษาไทย)</strong> ' + $('#txt-thTitle').text() + '<br><strong>ชื่อโครงการ (English)</strong> ' + $('#txt-enTitle').text() + '</p>' +

                                            '<p><strong>เรียน</strong> ' + $('#txt-pm-name').text() + '</p>' +
                                            '<p>เจ้าหน้าที่สำนักงานจริยธรรมการวิจัยในมนุษย์ได้ทำการตรวจสอบเอกสารในการการรายงาน' + $('#ptype').text() +'แล้ว ผลการตรวจสอบ คือ <span style="font-size: 1.5em; color: red;">เอกสารเบื้องต้นไม่ถูกต้อง</span> ดังรายละเอียดต่อไปนี้' +
                                            '</p>' +
                                            '<p>' +
                                              '<div style="padding: 20px; background: rgb(240, 240, 240);">' + editData.getData() + '</div>' +
                                            '</p>' +
                                            '<p>จึงขอให้ท่านดำเนินการแก้ไขหรือเพิ่มเติมเอกสาร ดังรายการข้างต้น</p>' +
                                            '<p>ทั้งนี้ ท่านสามารถตรวจสอบข้อมูลอื่น ๆ เพิ่มเติมได้ที่ <a href="' + root_domain + '" target="_blank">' + root_domain +'</a> หรือติดต่อเจ้าหน้าที่ที่หมายเลข 1157, 1149</p>' +
                                            '<p>จึงเรียนมาเพื่อทราบ <br>ระบบสารสนเทศเพื่อการจัดการงานวิจัย (RMIS)</p>' +
                                            '<p>หมายเหตุ: กรุณาอย่าตอบกลับทาง e-mail นี้';


                          var emailParam = {
                            email: emailConfig.user,
                            api_key: emailConfig.key,
                            title: "{ No-reply } การรายงานที่ " + $('#txt-ref').text() + " : ผลการพิจารณาความถูกต้องของเอกสารการรายงาน" + $('#ptype').text(),
                            to_email: $('#txtPiemail').val(),
                            content: dataContent
                          }

                          var jxhr = $.post(emailProvider, emailParam, function(){})
                                      .always(function(res){
                                        if(res!='Y'){
                                          swal({    title: "ดำเนินการสำเร็จ",
                                          text: "ข้อมูลการรายงานนี้ถูกบันทึกเรียบร้อยแล้ว แต่การส่งอีเมล์ผิดพลาด ให้ติดต่อผู้ดูแลระบบ",
                                          type: "warning",
                                          showCancelButton: false,
                                          confirmButtonColor: "#DD6B55",
                                          confirmButtonText: "รับทราบ",
                                          closeOnConfirm: false },
                                          function(){
                                            window.location = 'new-cont-list.html'
                                          });
                                        }else{
                                          swal({    title: "ดำเนินการสำเร็จ",
                                          text: "ข้อมูลการรายงานนี้ถูกบันทึกส่งไปยังผู้วิจัยเรียบร้อยแล้ว",
                                          type: "success",
                                          showCancelButton: false,
                                          confirmButtonColor: "#DD6B55",
                                          confirmButtonText: "กลับสู่หน้ารายการ",
                                          closeOnConfirm: false },
                                          function(){
                                            window.location = 'new-cont-list.html'
                                          });
                                        }
                                      })


                        }else{
                          lp.hl()
                          swal("ขออภัย!", "เกิดข้อผิดพลาด!", "error")
                        }
                    })
                    .fail(function(){
                      lp.hl()
                      swal("ขออภัย!", "ไม่สามารถเชื่อมต่อฐานข้อมูลได้!", "error")
                    })
      });




    }


    function sendCorrent(){
      var information = editData2.getData()

      var ecfullname = $('#txtECname').val()
      var ecemail = $('#txtECemail').val()

      if($('#txtEC').val() == ''){
        swal("ขออภัย!", "กรุณากรอกเลขา EC การดำเนินการ!", "error")
        return ;
      }

      if((ecfullname == '') || (ecemail == '')){
        swal("ขออภัย!", "กรุณากรอกเลขา EC การดำเนินการ!", "error")
        return ;
      }


      swal({
        title: "ยืนยันการดำเนินการ",
        text: "คุฯยืนยันส่งข้อมูลเหล่านี้ไปยังเลขาที่เลือกหรือไม่!",
        type: "warning",
        showCancelButton: true,
        confirmButtonColor: "#DD6B55",
        confirmButtonText: "ยืนยัน",
        cancelButtonText: "ยกเลิก",
        closeOnConfirm: true
      },
      function(){
        var param  = {
          rp_id: current_pid,
          user: current_user,
          info: information,
          id_ec: $('#txtEC').val()
        }

        lp.sl();

        var jxhr = $.post(ws_url + 'controller/staff/update_continuing_stop1_2.php', param ,function(){})
                    .always(function(resp){
                      // console.log(resp);
                        if(resp == 'Y'){

                          lp.sl()

                          $rc = $('#txt-rec').text();

                          var dataContent = '<h3>ผลการตรวจสอบความถูกต้องของเอกสารการรายงาน' + $('#ptype').text() +' </h3>' +

                                            '<p style="font-size: 1.3em;"><strong>รหัสโครงการของท่าน คือ <span style="color: red;">REC.' + $rc + '</span></strong><br><strong>รหัสโครงการรายงาน คือ <span style="color: red;">REF. ' + $('#txt-ref').text() + '</span></strong></p>' +
                                            '<p><strong>ชื่อโครงการ (ภาษาไทย)</strong> ' + $('#txt-thTitle').text() + '<br><strong>ชื่อโครงการ (English)</strong> ' + $('#txt-enTitle').text() + '</p>' +

                                            '<p><strong>เรียน</strong> ' + $('#txt-pm-name').text() + '</p>' +
                                            '<p>เจ้าหน้าที่สำนักงานจริยธรรมการวิจัยในมนุษย์ได้ทำการตรวจสอบเอกสารในการการรายงาน' + $('#ptype').text() +'แล้ว ผลการตรวจสอบ คือ <span style="font-size: 1.5em; color: green;">เอกสารเบื้องต้นถูกต้อง</span> ดังรายละเอียดต่อไปนี้' +
                                            '</p>' +
                                            '<p>จึงขอให้ท่านดำเนินการแก้ไขหรือเพิ่มเติมเอกสาร ดังรายการข้างต้น</p>' +
                                            '<p>ทั้งนี้ ท่านสามารถตรวจสอบข้อมูลอื่น ๆ เพิ่มเติมได้ที่ <a href="' + root_domain + '" target="_blank">' + root_domain +'</a> หรือติดต่อเจ้าหน้าที่ที่หมายเลข 1157, 1149</p>' +
                                            '<p>จึงเรียนมาเพื่อทราบ <br>ระบบสารสนเทศเพื่อการจัดการงานวิจัย (RMIS)</p>' +
                                            '<p>หมายเหตุ: กรุณาอย่าตอบกลับทาง e-mail นี้';

                          var str = dataContent.replace(/\n/g, ' ')
                          var param = {
                            title: "การรายงานที่ " + $('#txt-ref').text() + " : ผลการพิจารณาความถูกต้องของเอกสารการรายงาน" + $('#ptype').text(),
                            content: str,
                            user: 'tagoon.p@gmail.com',
                            key: 'idj&skeoXf2**r123X',
                            toemail: $('#txt-email').text(),
                            toname: $('#txt-pm-name').text()
                          }

                          main.send_email(param, 'reload', 'ท่านส่งอีเมล์ถึง Reviewer เรียบร้อยแล้ว', 'ระบบได้ดำเนินการตามกระบวนที่ท่านได้ดำเนินการแล้ว แต่เกิดข้อผิดพลาดในส่วนของการส่งอีเมล์ กรุณาแจ้งเจ้าหน้าที่เพื่อตรวจสอบและดำเนินการแก้ไข')
                          $('.btnClosemodal').trigger('click')
                          // return ;

                          var dataContent2 = '<h3>รายงาน ' + $('#ptype').text() + ' ของโครงการ REC.' + $('#txt-rec').text() + ' รอการตรวจสอบความถูกต้อง</h3>' +
                                            '<p>เรียน ' + ecfullname + '</p>' +
                                            '<p>มีรายงานกระบวนการวิจัยของโครงการวิจัย รหัส REC.' + $('#txt-rec').text() + ' อยู่ระหว่างรอท่านดำเนินการ กรุณาเข้าสู่ระบบ RMIS และดำเนินการต่อ' +
                                            'ได้ที่ <a href="' + root_domain + '" target="_blank">' + root_domain +'</a></p>' +
                                            '<p>จึงเรียนมาเพื่อทราบ <br>ระบบสารสนเทศเพื่อการจัดการงานวิจัย (RMIS)</p>';

                          var str = dataContent2.replace(/\n/g, ' ')
                          var param = {
                            title: "REC." + $('#txt-rec').text() + " : รายงานการดำเนินการโครงการวิจัยการ" + $('#ptype').text(),
                            content: str,
                            user: 'tagoon.p@gmail.com',
                            key: 'idj&skeoXf2**r123X',
                            toemail: ecemail,
                            toname: ''
                          }

                          main.send_email(param, 'reload', 'ท่านส่งอีเมล์ถึง Reviewer เรียบร้อยแล้ว', 'ระบบได้ดำเนินการตามกระบวนที่ท่านได้ดำเนินการแล้ว แต่เกิดข้อผิดพลาดในส่วนของการส่งอีเมล์ กรุณาแจ้งเจ้าหน้าที่เพื่อตรวจสอบและดำเนินการแก้ไข')
                          $('.btnClosemodal').trigger('click')

                                            var emailParam2 = {
                                              email: emailConfig.user,
                                              api_key: emailConfig.key,
                                              title: "{ No-reply } REC." + $('#txt-rec').text() + " : รายงานการดำเนินการโครงการวิจัยการ" + $('#ptype').text(),
                                              to_email: ecemail ,
                                              content: dataContent2
                                            }

                          // var emailParam = {
                          //   email: emailConfig.user,
                          //   api_key: emailConfig.key,
                          //   title: "{ No-reply } การรายงานที่ " + $('#txt-ref').text() + " : ผลการพิจารณาความถูกต้องของเอกสารการรายงาน" + $('#ptype').text(),
                          //   to_email: $('#txt-email').text(),
                          //   content: dataContent
                          // }

                          var jxhr = $.post(emailProvider, emailParam, function(){})
                                      .always(function(res){
                                        console.log(res);
                                        if(res!='Y'){
                                          swal({    title: "ดำเนินการสำเร็จ",
                                          text: "ข้อมูลการรายงานนี้ถูกบันทึกเรียบร้อยแล้ว แต่การส่งอีเมล์ผิดพลาด ให้ติดต่อผู้ดูแลระบบ",
                                          type: "warning",
                                          showCancelButton: false,
                                          confirmButtonColor: "#DD6B55",
                                          confirmButtonText: "รับทราบ",
                                          closeOnConfirm: false },
                                          function(){
                                            window.location = 'new-cont-list.html'
                                          });
                                        }else{

                                          var dataContent2 = '<h3>รายงาน ' + $('#ptype').text() + ' ของโครงการ REC.' + $('#txt-rec').text() + ' รอการตรวจสอบความถูกต้อง</h3>' +
                                                            '<p>เรียน ' + ecfullname + '</p>' +
                                                            '<p>มีรายงานกระบวนการวิจัยของโครงการวิจัย รหัส REC.' + $('#txt-rec').text() + ' อยู่ระหว่างรอท่านดำเนินการ กรุณาเข้าสู่ระบบ RMIS และดำเนินการต่อ' +
                                                            'ได้ที่ <a href="' + root_domain + '" target="_blank">' + root_domain +'</a></p>' +
                                                            '<p>จึงเรียนมาเพื่อทราบ <br>ระบบสารสนเทศเพื่อการจัดการงานวิจัย (RMIS)</p>';

                                          var emailParam2 = {
                                            email: emailConfig.user,
                                            api_key: emailConfig.key,
                                            title: "{ No-reply } REC." + $('#txt-rec').text() + " : รายงานการดำเนินการโครงการวิจัยการ" + $('#ptype').text(),
                                            to_email: ecemail ,
                                            content: dataContent2
                                          }

                                          var jxhrc = $.post(emailProvider, emailParam2, function(){})
                                                      .always(function(res){
                                                        if(res != 'Y'){
                                                          swal({    title: "ดำเนินการสำเร็จ",
                                                          text: "ข้อมูลการรายงานนี้ถูกบันทึกเรียบร้อยแล้ว แต่การส่งอีเมล์ไปยังเลขา EC ผิดพลาด ให้ติดต่อผู้ดูแลระบบ",
                                                          type: "warning",
                                                          showCancelButton: false,
                                                          confirmButtonColor: "#DD6B55",
                                                          confirmButtonText: "รับทราบ",
                                                          closeOnConfirm: false },
                                                          function(){
                                                            window.location = 'new-cont-list.html'
                                                          });
                                                        }else{

                                                          swal({    title: "ดำเนินการสำเร็จ",
                                                          text: "ข้อมูลการรายงานนี้ถูกบันทึกส่งไปยังผู้วิจัยเรียบร้อยแล้ว",
                                                          type: "success",
                                                          showCancelButton: false,
                                                          confirmButtonColor: "#DD6B55",
                                                          confirmButtonText: "กลับสู่หน้ารายการ",
                                                          closeOnConfirm: false },
                                                          function(){
                                                            window.location = 'new-cont-list.html'
                                                          });
                                                        }

                                                      })
                                          //
                                          // swal({    title: "ดำเนินการสำเร็จ",
                                          // text: "ข้อมูลการรายงานนี้ถูกบันทึกส่งไปยังผู้วิจัยเรียบร้อยแล้ว",
                                          // type: "success",
                                          // showCancelButton: false,
                                          // confirmButtonColor: "#DD6B55",
                                          // confirmButtonText: "กลับสู่หน้ารายการ",
                                          // closeOnConfirm: false },
                                          // function(){
                                          //   window.location = 'new-cont-list.html'
                                          // });
                                        }
                                      })


                        }else{
                          lp.hl()
                          swal("ขออภัย!", "เกิดข้อผิดพลาด!", "error")
                        }
                    })
                    .fail(function(){
                      lp.hl()
                      swal("ขออภัย!", "ไม่สามารถเชื่อมต่อฐานข้อมูลได้!", "error")
                    })
      });
    }

    function goto_report(progress_id){
      window.localStorage.setItem('rmis_current_progress_id', progress_id)
      window.location = 'create_report.html'
    }
  </script>
</body>

</html>
