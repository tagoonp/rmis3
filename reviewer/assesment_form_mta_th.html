<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8" />
  	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  	<title>:: RMIS :: สำหรับผู้เชี่ยวชาญอิสระ ::</title>

    <!-- Data table CSS -->
  	<link href="../v4/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

    <!--alerts CSS -->
  	<link href="../v3/vendors/bower_components/sweetalert/dist/sweetalert.css" rel="stylesheet" type="text/css">

    <!-- Data table CSS -->
    <link href="../v3/vendors/bower_components/datatables/media/css/jquery.dataTables.min.css" rel="stylesheet" type="text/css"/>

    <!-- Fontawesom -->
    <link href="../v4/bower_components/fontawesome/web-fonts-with-css/css/fontawesome-all.css" rel="stylesheet">

    <!-- Custom CSS -->
    <!-- <link href="../v3/dist/css/style.css" rel="stylesheet" type="text/css">
    <link href="../v3/fonts.css" rel="stylesheet" type="text/css">
    <link href="../v3/style_v2.css" rel="stylesheet" type="text/css"> -->
    <!-- Preload -->
    <link rel="stylesheet" href="../v4/node_modules/preload.js/dist/css/preload.css">

    <!-- Material Design Bootstrap -->
    <link href="../v4/node_modules/mdbootstrap/css/mdb.min.css" rel="stylesheet">
    <link href="../v4/node_modules/mdbootstrap/css/style.css" rel="stylesheet">

    <link rel="stylesheet" href="../v4/assets/css/style.css">
    <link rel="stylesheet" href="../v4/assets/css/fonts.css">

  </head>

  <style media="screen">
    body{
      background: rgb(245, 245, 245);
    }
  </style>

  <body>

    <div class="header fixed-top" style="background: rgb(31, 147, 12) !important; border: solid; border-width: 0px 0px 1px 0px; border-color: rgb(233, 233, 233);">
      <div class="container">
        <!--Navbar-->
        <nav class="navbar navbar-expand-lg navbar-dark blue" style="background: rgb(31, 147, 12) !important; box-shadow: none;">

          <!-- Navbar brand -->
          <a class="navbar-brand th_font fw500  text-white" href="index.html" style="font-size: 1.9em; margin-top: -3px;">RMIS@Medicine</a>

          <!-- Collapse button -->
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#basicExampleNav" aria-controls="basicExampleNav"
              aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
          </button>

          <!-- Collapsible content -->
          <div class="collapse navbar-collapse" id="basicExampleNav" style="margin-top: -4px;">
              <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item active dn">
                  <a href="index.html" class="nav-link active">หน้าแรก</a>
                </li>
              </ul>

              <div class="form-inline my-2 my-lg-0">
                <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                  <li class="nav-item ">
                    <a href="profile.html" class="nav-link text-white">ยินดีต้อนรับ, คุณ<span class="userFullname text-white">NA</span> (REVIEWER)</a>
                  </li>
                  <li class="nav-item ">
                    <a href="changepassword.html" class="nav-link text-white">เปลี่ยนรหัสผ่าน</a>
                  </li>
                  <li class="nav-item ">
                    <a href="#" class="nav-link text-white" onclick="main.signout()">ออกจากระบบ</a>
                  </li>
                </ul>
              </div>
          </div>
          <!-- Collapsible content -->

        </nav>
        <!--/.Navbar-->
      </div>
    </div>

    <div class="group-1 pb-50" style="padding-top: 90px;">
      <div class="container">

        <div class="row">
          <div class="col-sm-12">
            <h3 class="fw500">แบบประเมินเอกสารด้านกฎหมายโครงการวิจัย<br><small>(ทบทวนครั้งแรก)</small></h3>
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html">หน้าแรก</a></li>
                <li class="breadcrumb-item"><a href="index.html">โครงการรอการพิจารณา</a></li>
                <li class="breadcrumb-item active" aria-current="page"><a href="research_info.html" class="txt-CodeApdu">Loading ...</a></li>
              </ol>
            </nav>
          </div>
        </div>

        <div class="row">
          <div class="col-sm-12">
            <div class="row mb-20">
              <div class="col-sm-12">
                <div style="padding: 20px; background: rgb(240, 237, 237); border: dashed; border-color: rgb(15, 179, 130); color: rgb(15, 122, 96); border-width: 1px;" class="">
                  <bold class="f500">คำแนะนำ</bold> ท่านสามารถกดปุ่ม "บันทึกแบบร่าง" แล้วกลับมาทำต่อได้ภายหลัง
                </div>
              </div>
            </div>
          </div>
          <div class="col-sm-12 mb-10">
            <div class="card mb-10">
              <div class="card-body">

                <div class="row">
                  <div class="col-sm-12">
                    <div class="pl-20 txt-dark">
                      <div class="row">
                        <div class="col-sm-3 f500">รหัสโครงการ</div>
                        <div class="col-sm-9"><span id="txtCode" class="txt-danger">ยังไม่กำหนด</span></div>
                      </div>
                      <div class="row">
                        <div class="col-sm-3 f500">ชื่อโครงการ (ภาษาไทย)</div>
                        <div class="col-sm-9"><span id="txtThtitle">NA</span></div>
                      </div>
                      <div class="row">
                        <div class="col-sm-3 f500">ชื่อโครงการ (ภาษาอังกฤษ)</div>
                        <div class="col-sm-9"><span id="txtEntitle">NA</span></div>
                      </div>
                    </div>

                    <div class="pl-20 pr-20 pt-20">
                      <div class="row">
                        <div class="col-sm-12">
                          <div class="form-group">
                            <label class="txt-dark f500"><span class="text-success-2">ส่วนที่ 1</span> :: กรุณาพิมพ์ความเห็นในภาพรวมเกี่ยวกับโครงการ (General comment)
                              <!-- ในภาพรวมเกี่ยวกับโครงการ (General comment) เช่น องค์ความรู้ใหม่ ประโยชน์ ความเหมาะสมของงบประมาณ ฯลฯ  -->
                              <span class="text-danger">** </span></label>
                            <input type="text" class="form-control" name="q_generalcomment_bio" id="q_generalcomment_bio">
                          </div>
                        </div>
                      </div>

                      <div class="table-responsive_">
                        <div class="col-sm-12">
                          <div class="form-group">
                            <input type="text" class="form-control dn" name="q_assesment_id_bio" id="q_assesment_id_bio">
                          </div>
                        </div>
                        <label class="txt-dark f500"><span class="text-success-2">ส่วนที่ 2</span> :: หากท่านมีประเด็นข้อคำถามหรือข้อเสนอแนะ ให้กดปุ่ม "เพิ่มคำถามหรือข้อเสนอแนะ" เพื่อเพิ่มประเด็นข้อคำถามหรือข้อเสนอแนะ <span class="text-danger">** </span></label>

                        <table class="table table-bordered">
                          <thead>
                            <tr style="background: rgb(117, 120, 119);">
                              <th class="txt-light" style="width: 10%;">ข้อ</th>
                              <th class="txt-light">คำถามหรือข้อเสนอแนะจากกรรมการ</th>
                              <th style="width: 150px;"></th>
                            </tr>
                          </thead>
                          <tbody id="mtaComment">
                            <tr>
                              <td class="text-center" colspan="3" >
                                ยังไม่มีข้อคำถามหรือข้อเสนอแนะจากกรรมการ
                              </td>
                            </tr>
                          </tbody>
                          <tbody>
                            <tr>
                              <td class="text-center" colspan="3">
                                <div style="padding: 10px 0px;">
                                  <button class="btn btn-success" onclick="showMtaModal()"><i class="fas fa-plus"></i> เพิ่มคำถามหรือข้อเสนอแนะ</button>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>

                      </div>

                      <label class="txt-dark f500"><span class="text-success-2">ส่วนที่ 3</span> ::  โดยสรุป ท่านเห็นชอบกับเอกสารทางกฏหมายที่พิจารณาหรือไม่ <span class="text-danger">** </span></label>
                      <table class="table table-bordered">
                        <tbody>
                          <tr class="dn">
                            <td>
                              <div class="radio radio-lg radio-success dn">
                                <input type="radio"  id="checkbox042-99" name="radio042" value="na" checked/>
                                <label for="checkbox042-99"></label>
                              </div>
                            </td>
                            <td> </td>
                          </tr>
                          <tr>
                            <td style="width: 10%;" class="text-center">
                              <div class="radio radio-lg radio-success">
                                <input type="radio" class="radio_btn" id="checkbox042-1" name="radio042" value="1"  />
                                <label for="checkbox042-1"></label>
                              </div>
                            </td>
                            <td>เห็นชอบ</td>
                          </tr>
                          <tr>
                            <td class="text-center">
                              <div class="radio radio-lg radio-success">
                                <input type="radio" class="radio_btn" id="checkbox042-3" name="radio042" value="2" />
                                <label for="checkbox042-3"></label>
                              </div>
                            </td>
                            <td>เห็นชอบ หากแก้ไขตามข้อเสนอแนะ</td>
                          </tr>
                          <tr>
                            <td class="text-center">
                              <div class="radio radio-lg radio-success">
                                <input type="radio" class="radio_btn" id="checkbox042-2" name="radio042" value="3" />
                                <label for="checkbox042-2"></label>
                              </div>
                            </td>
                            <td>ไม่เห็นชอบ เนื่องจาก
                              <div class="pt-5 dn" id="notFitInfo">
                                <input type="text" class="form-control" name="q_generalcomment_notfit2" id="q_generalcomment_notfit2">
                              </div>
                            </td>
                          </tr>

                        </tbody>
                      </table>

                      <label class="txt-dark f500"><span class="text-success-2">ส่วนที่ 4</span> :: ตรวจสอบความครบถ้วนของคำตอบ</label>
                      <div class="row mb-20">
                        <div class="col-sm-12">
                          <div style="padding: 20px; background: rgb(255, 231, 243);" class="text-danger" id="notifyf">
                            ยังไม่ครบถ้วน
                          </div>

                          <div style="padding: 20px; background: rgb(231, 255, 240);" class="text-success dn" id="notifys">
                            ท่านตอบแบบประเมินครบถ้วนแล้ว
                          </div>
                        </div>
                      </div>
                      <div class="text-center">
                        <button type="button" class="btn btn-success text-center btnAssesmentDraft" id="" >บันทึกแบบร่าง/ตรวจสอบความครบถ้วน</button>
                        <button type="button" class="btn btn-danger text-center dn"  id="btnConfirmMta">บันทึกแบบประเมิน</button>
                      </div>

                    </div>
                    <!-- .assesment_panal -->
                  </div>
                </div>
              </div>
            </div>



          </div>
        </div>
        <!-- .row -->




      </div>
    </div>

    <div class="custom-footer pt-30 pb-30">
      <div class="container text-center">
        2017 © RMIS. หน่วยส่งเสริมและพัฒนาทางวิชาการ คณะแพทยศาสตร์ มหาวิทยาลัยสงขลานครินทร์. .
      </div>
    </div>

    <!-- jQuery -->
    <script src="../v3/vendors/bower_components/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <!-- <script src="../v3/vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script> -->
    <script src="../v4/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
  	<!-- Slimscroll JavaScript -->
  	<script src="../v3/dist/js/jquery.slimscroll.js"></script>
  	<!-- Fancy Dropdown JS -->
  	<script src="../v3/dist/js/dropdown-bootstrap-extended.js"></script>
    <!-- Sweet-Alert  -->
  	<script src="../v3/vendors/bower_components/sweetalert/dist/sweetalert.min.js"></script>
    <!-- Data table JavaScript -->
    <script src="../v3/vendors/bower_components/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="../v3/dist/js/dataTables-data.js"></script>
    <!-- Data table JavaScript -->
    <script type="text/javascript" src="../v3/vendors/bower_components/ckeditor4/ckeditor.js"></script>

    <!-- MDB core JavaScript -->
    <script type="text/javascript" src="../v4/node_modules/mdbootstrap/js/mdb.min.js"></script>

  	<!-- Init JavaScript -->
    <script src="../v4/config.js"></script>
  	<script src="../v3/dist/js/init.js"></script>
    <script src="../v3/main.js"></script>
    <script src="../v4/reviewer.js"></script>

    <script type="text/javascript" src="../v4/node_modules/preload.js/dist/js/preload.js"></script>
    <script type="text/javascript" src="../v3/vendors/bower_components/ckeditor_lite/ckeditor.js"></script>

    <script type="text/javascript">

      var current_rs = window.localStorage.getItem('current_selected_project_session')
      var current_rs_id = window.localStorage.getItem('current_selected_project_id')
      var current_form = window.localStorage.getItem('rmis_current_assesment_form')
      var comment_other_1 = '', comment_other_2 = ''
      var editData = '';
      var reply_status = '0';
      var numreplyfile = 0;
      var files;
      var eformnum = 0
      var eformnum_success = 0
      var gc_bio = '';
      var gc_icf = '';
      var notfin_info  = '';

      $(document).ready(function(){

        if(current_rs == null){
          swal({    title: "เกิดข้อผิดพลาด",
                      text: "ไม่พบข้อมูลงานวิจัยที่ต้องการ กรุณาลองใหม่ หรือติดต่อเจ้าหน้าที่!",
                      type: "error",
                      showCancelButton: false,
                      confirmButtonColor: "#DD6B55",
                      confirmButtonText: "รับทราบ",
                      closeOnConfirm: false },
                      function(){
                       window.location = './'
                      });
        }

        if(current_form == null){
          swal({    title: "เกิดข้อผิดพลาด",
                      text: "ไม่พบข้อมูลฟอร์มแบบประเมิน่!",
                      type: "error",
                      showCancelButton: false,
                      confirmButtonColor: "#DD6B55",
                      confirmButtonText: "รับทราบ",
                      closeOnConfirm: false },
                      function(){
                       window.history.back()
                      });
        }


        reviewer.init()
        reviewer.load_rs_info_2();

        gc_bio = CKEDITOR.replace( 'q_generalcomment_bio', { height: '250px' });
        notfin_info  = CKEDITOR.replace( 'q_generalcomment_notfit', { height: '250px' });
        notfin_info2  = CKEDITOR.replace( 'q_generalcomment_notfit2', { height: '250px' });

        loadMTAInfo()

        setTimeout(function(){
          preload.hide()
        }, 1000)

      })

      $(function(){

        gc_bio.on("instanceReady", function(){
          this.document.on("keyup", function(){
              checkMtaStatus()
          });
        });

        notfin_info2.on("instanceReady", function(){
          this.document.on("keyup", function(){
              checkMtaStatus()
          });
        });

        setInterval(function(){ saveCommentDraft_mta(2); }, 60000);

        $('.btnAssesmentDraft').click(function(){
          saveCommentDraft_mta()
        })

        $('.radio_btn').click(function(){
          checkMtaStatus()
          saveCommentDraft_mta(2);
          if($('input[name=radio042]:checked').val() == '3'){
            $('#notFitInfo').removeClass('dn')
          }else{
            $('#notFitInfo').addClass('dn')
            notfin_info2.setData('')
          }
        })

        $('#btnConfirmMta').click(function(){
          saveCommentDraft_mta(1)
        })

      })

      function showMtaModal(){
        console.log('a');
        $('.bs-example-modal-lg-do').modal({})
      }

      function closeCommentBox(){
        var msg = notfin_info.getData();
        if(msg == ''){
          if((current_ele_id != '') && (current_ele_id != null)){
            var $radios = $('input[name=radio0' + current_ele_id + ']');
            // $radios.filter('[value=na]').attr('checked', 'checked');
            $radios.filter('[value=na]').prop('checked', true);
            $( "#comment_div_id_" +  current_ele_id).remove();
          }
        }else{
          // var $radios = $('input[name=radio0' + current_ele_id + ']');
          // // $radios.filter('[value=na]').attr('checked', 'checked');
          // $radios.filter('[value=na]').prop('checked', true);
          // notfin_info.setData('');
          // $( "#comment_div_id_" +  current_ele_id).remove();
        }
      }

      function saveMTAComment(){

        var comment_msg = notfin_info.getData()

        if(comment_msg == ''){
          swal("ขออภัย", "กรุณาเพิ่มความเห็นและข้อเสนอแนะเพื่อปรับปรุงก่อน", "error")
          return ;
        }

        var param = {
          cm_id: $('#txtPid').val(),
          com_msg: comment_msg,
          id_rs: current_rs_id,
          user: current_user,
          form_id: '8'
        }

        var jxr = $.post(ws_url + 'controller/reviewer/save-mta-comment.php', param, function(){})
                   .always(function(resp){
                     if(resp == 'Y'){
                        loadMTACommentList()
                        $('.btnCloseModal').trigger('click')
                     }else{
                       swal("ขออภัย", "ไม่สามารถเพิ่มความเห็นหรือข้อเสนอแนะได้", "error")
                       return ;
                     }
                   })
      }

      function loadMTAInfo(){
        var param = {
          id_rs: current_rs_id,
          user: current_user
        }

        var jxr = $.post(ws_url + 'controller/reviewer/load-mta-info.php', param, function(){}, 'json')
                   .always(function(snap){
                     if((snap != '') && (snap.length > 0)){
                      snap.forEach(function(i){
                        gc_bio.setData(i.efm_gc)
                        notfin_info2.setData(i.efm_conclusion_comment)
                        $("input[name=radio042][value=" + i.efm_conclustion + "]").attr('checked', 'checked');
                        if(i.efm_conclustion == '3'){
                          $('#notFitInfo').removeClass('dn')
                        }
                      })

                      setTimeout(function(){
                        checkMtaStatus()
                      }, 1000)
                     }
                   })

          loadMTACommentList()
      }

      function loadMTACommentList(){
        var param = {
          id_rs: current_rs_id,
          user: current_user
        }

        var jxr = $.post(ws_url + 'controller/reviewer/load-mta-comment.php', param, function(){}, 'json')
                   .always(function(snap){
                     // console.log(snap);
                     if((snap != '') && (snap.length > 0)){
                      $('#mtaComment').empty()
                      $c = 1;
                      snap.forEach(function(i){
                        $data = '<tr>' +
                                  '<td>' + $c + '</td>' +
                                  '<td>' + i.cmta_msg + '</td>' +
                                  '<td class="text-center">' +
                                    // '<button class="btn btn-success btn-square"><i class="fa fa-edit"></i></button> ' +
                                    // '<button class="btn btn-success btn-square btn-sm" onclick="deleteMTAComment(\'' + i.cmta_id + '\')"><i class="fa fa-pencil-alt"></i></button>' +
                                    '<button class="btn btn-danger btn-square btn-sm" onclick="deleteMTAComment(\'' + i.cmta_id + '\')"><i class="fa fa-trash"></i></button>' +
                                  '</td>' +
                                '</tr>'
                        $('#mtaComment').append($data)
                        $c++;
                      })
                     }else{
                      $('#mtaComment').empty()
                      $('#mtaComment').append('<tr><td class="text-center" colspan="3" >ยังไม่มีข้อคำถามหรือข้อเสนอแนะจากกรรมการ</td></tr>')
                     }
                   })
      }

      function deleteMTAComment(mta_id){
        swal({   title: "ยืนยันดำเนินการ",
                 text: "คุณยืนยันการลบข้อคำถาม/ข้อเสนอแนะนี้หรือไม่",
                 type: "warning",
                 showCancelButton: true,
                 confirmButtonColor: "#DD6B55",
                 confirmButtonText: "ลบ",
                 cancelButtonText: "ยกเลิก",
                 closeOnConfirm: true,
                 closeOnCancel: true },
                 function(isConfirm){
                     if (isConfirm) {
                       var param = {
                         id: mta_id,
                         id_rs: current_rs_id,
                         user: current_user
                       }

                       var jxr = $.post(ws_url + 'controller/reviewer/delete-mta-comment.php', param, function(){})
                                  .always(function(resp){
                                    if(resp == 'Y'){
                                      // swal("ดำเนินการสำเร็จ", "ลบความเห็น/ข้อเสนอแนะเรียบร้อยแล้ว", "success")
                                      loadMTACommentList()
                                    }else{
                                      swal("ขออภัย", "ไม่สามารถเพิ่มความเห็นหรือข้อเสนอแนะได้", "error")
                                      return ;
                                    }
                                  })

                     }
                });
      }

    </script>

  </body>
</html>



<!-- sample modal content -->
<div class="modal fade bs-example-modal-lg-do" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header text-left" style="background: rgb(13, 175, 102);">
          <h5 class="modal-title txt-light f500 text-left" id="myLargeModalLabel"><span id="ass_title">เพิ่มประเด็นข้อคำถามหรือข้อเสนอแนะ</span></h5>
        <button type="button" class="close btnCloseModal" data-dismiss="modal" aria-hidden="true">×</button>

      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-sm-12">
            <div class="form-group dn">
              <input type="text" name="txtPid" id="txtPid">
            </div>

            <div class="form-group">
              <label class="txt-dark"><div class="f500">กรุณาพิมพ์ความเห็นและข้อเสนอแนะเพื่อปรับปรุง <span class="text-danger">** </span></div>
                <div style="font-size: 0.8em;">
                  หากเป็นไปได้ กรุณาระบุว่าควรแก้ไขเอกสารฉบับ/หัวข้อ/หน้าใด และอย่างไร หรือควรจัดทำเอกสารเพิ่มเติมอย่างไร
                </div>
              </label>
              <!-- <input type="text" class="form-control" name="q_generalcomment_notfit" id="q_generalcomment_notfit"> -->
              <input type="text" class="form-control" name="q_generalcomment_notfit" id="q_generalcomment_notfit">
            </div>

            <div class="text-right">
              <button type="button" class="btn btn-danger text-center" onclick="saveMTAComment()">บันทึกข้อเสนอแนะ</button>
              <button type="button" class="btn btn-danger text-center" data-dismiss="modal" onclick="closeCommentBox()">ปิด</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- /.modal-content -->
  </div>
  <!-- /.modal-dialog -->
</div>
<!-- /.modal -->
