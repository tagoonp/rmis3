<!DOCTYPE html>
<html>
    <head>
        <title>RMIS:ระบบสารสนเทศเพื่อการจัดการงานวิจัย คณะแพทยศาสตร์ มอ.</title>
        <!-- Meta Tags -->
        <meta charset="UTF-8" />
    		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
        <!-- Data table CSS -->
        <link href="v4/bower_components/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
        <!--alerts CSS -->
      	<link href="v3/vendors/bower_components/sweetalert/dist/sweetalert.css" rel="stylesheet" type="text/css">
        <!-- Fontawesom -->
        <link href="v4/bower_components/fontawesome/web-fonts-with-css/css/fontawesome-all.css" rel="stylesheet">
        <!-- Preload -->
        <link rel="stylesheet" href="v4/node_modules/preload.js/dist/css/preload.css">

        <link rel="stylesheet" href="v4/assets/css/style.css">

    </head>

    <style>
      body{
        background: rgb(246, 244, 244) !important;
      }
    </style>



    <body>

      <div class="cbsd_1 d-block d-sm-none mb-20" style="top: 0px; background: #fff; position: fixed; width: 100%; z-index: 9999999; ">
        <div style="background: #02946c !important;">
          <div class="container">
            <div class="pl-0 pt-10 pb-10">
              <a href="index.html" class="text-white"><i class="fas fa-chevron-left mr-5"></i>กลับสู่หน้าเข้าสู่ระบบ</a>
            </div>
          </div>
        </div>
      </div>

      <div class="cbsd_1 d-none d-sm-block" style="top: 0px; background: #fff; position: fixed; width: 100%; z-index: 9999999; ">
        <div style="background: #02946c !important;">
          <div class="container-fluid">
            <div class="row">
              <div class="col-sm-3">
                <div class="pd-10 text-white text-left">
                  <a href="index.html" class="text-white"><i class="fas fa-home mr-5"></i> กลับหน้าหลัก</a>
                </div>
              </div>
              <div class="col-sm-9">
                <div class="pd-10 text-white text-right">
                  ** หากพบปัญหา ติดต่อ คุณณัฎฐา (กิ๊ก) หน่วยส่งเสริมและพัฒนาทางวิชาการ (<i class="fas fa-phone"></i> 1149, 1157)
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <form onsubmit="return false;" class="register-form-v2" autocomplete="off">
        <div class="container" style="margin-top: 70px;" id="main-container">
          <div class="row">
            <div class="col-sm-12">

              <div class="row mb-10">
                <div class="col-sm-8 text-center pb-10  d-block d-sm-none">
                    <h3>แบบฟอร์มลงทะเบียนเพื่อใช้งานระบบ RMIS<font class="d-none d-sm-block">เพื่อใช้งานระบบ</font></h3>
                    <h5 class="text-muted">(สำรหับบุคลากรภายนอกคณะแพทยศาสตร์)</h5>
                </div>
              </div>

              <div class="row">
                <div class="col-sm-12 pb-10  d-none d-sm-block text-center">
                    <h3>แบบฟอร์มลงทะเบียนเพื่อใช้งานระบบ</h3>
                    <h5 class="text-muted">(สำรหับบุคลากรภายนอกคณะแพทยศาสตร์)</h5>
                </div>

              <div class="col-sm-12">
                <div class="alert alert-danger" role="alert">
                  <i class="fas fa-exclamation-triangle"></i> กรุณากรอกข้อมูลในช่องที่มีเครื่องหมาย ** ให้ครบถ้วน
                </div>
              </div>

                <div class="col-sm-12 mt-10">
                  <h5><span class="text-success">ส่วนที่ 1 : </span>ข้อมูลส่วนตัว</h5>
                  <div class="row">
                    <div class="col-sm-12">
                      <div class="card mb-10">
                        <div class="card-body">
                          <div class="row">
                            <div class="col-sm-4">
                              <div class="form-group">
                                <label for="" class="txt-dark f500 fs08">คำนำหน้าชื่อ<u>ที่ต้องการในใบรับรอง</u> <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="top" title="เช่น ผู้ช่วยศาสตราจารย์"></i> <span class="text-muted">(ถ้ามี)</span></label>
                                <input type="text" class="form-control" placeholder="กรอกคำนำหน้าชื่อ (ภาษาไทย) ..." id="txtPrefixTh" >
                                <small id="passwordHelpBlock" class="form-text text-muted pl-5">
                                  Enter your name title in english if can not type in Thai.
                                </small>
                              </div>
                            </div>
                            <div class="col-sm-4">
                              <div class="form-group">
                                <label for="" class="txt-dark f500 fs08">ชื่อ <span class="txt-danger">**</span></label>
                                <input type="text" class="form-control" placeholder="กรอกชื่อจริง (ภาษาไทย) ..." id="txtFnameTh">
                                <small id="passwordHelpBlock" class="form-text text-muted pl-5">
                                  Enter your name in english if can not type in Thai.
                                </small>
                              </div>
                            </div>
                            <div class="col-sm-4">
                              <div class="form-group">
                                <label for="" class="txt-dark f500 fs08">นามสกุล <span class="txt-danger">**</span></label>
                                <input type="text" class="form-control" placeholder="กรอกนามสกุล (ภาษาไทย) ..." id="txtLnameTh">
                                <small id="passwordHelpBlock" class="form-text text-muted pl-5">
                                  Enter your surname in english if can not type in Thai.
                                </small>
                              </div>
                            </div>
                          </div>

                          <div class="row">
                            <div class="col-sm-4">
                              <div class="form-group">
                                <label for="" class="txt-dark f500 fs08">Name title for certificate of approval <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="top" title="Eg. Professor"></i> <span class="text-muted">(If any)</span></label>
                                <input type="text" class="form-control" placeholder="Enter the name title ..." id="txtPrefixEn" >
                              </div>
                            </div>
                            <div class="col-sm-4">
                              <div class="form-group">
                                <label for="" class="txt-dark f500 fs08">Name <span class="txt-danger">**</span></label>
                                <input type="text" class="form-control" placeholder="Enter firstname ..." id="txtFnameEn">
                              </div>
                            </div>
                            <div class="col-sm-4">
                              <div class="form-group">
                                <label for="" class="txt-dark f500 fs08">Surname <span class="txt-danger">**</span></label>
                                <input type="text" class="form-control" placeholder="Enter suraname ..." id="txtLnameEn">
                              </div>
                            </div>
                          </div>

                          <div class="form-group">
                            <label for="" class="txt-dark f500 fs08">ประเภทบุคลากร (Personnel type) <span class="txt-danger">**</span></label>
                            <select class="form-control" name="txtPosition" id="txtPosition">
                              <option value="">--- เลือกประเภทบุคลากร ---</option>
                            </select>
                          </div>

                          <div class="form-group">
                            <label for="" class="txt-dark f500 fs08">สาขาเชี่ยวชาญ (Expertise)</label>
                            <textarea name="txtExp" id="txtExp" rows="2" cols="80" class="form-control" placeholder="กรอกสาขาเชี่ยวชาญ โดยแต่ละสาขาให้คั่นด้วยเครื่องหมายคอมม่า (,)"></textarea>
                          </div>

                          <div class="form-group">
                            <label for="" class="txt-dark f500 fs08">สาขางานวิจัยที่สนใจ (Research interests)</label>
                            <textarea name="txtRI" id="txtRI" rows="2" cols="80" class="form-control" placeholder="กรอกสาขางานวิจัยที่สนใจ โดยแต่ละเรื่องให้คั่นด้วยเครื่องหมายคอมม่า (,)"></textarea>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- .part 1 -->

                <div class="col-sm-12 pt-20">
                  <h5><span class="text-success">ส่วนที่ 2 : </span>หน่วยงานที่สังกัด</h5>
                  <div class="row">
                    <div class="col-sm-12">
                      <div class="card mb-10">
                        <div class="card-body">
                          <div class="row">
                            <div class="col-sm-12">
                              <div class="form-group">
                                <label for="" class="txt-dark f500 fs08">กลุ่มของหน่วยงานต้นสังกัด (Group of your institution) <span class="txt-danger">**</span></label>
                                <select class="form-control" name="txtInstitutionType" id="txtInstitutionType">
                                  <option value="">--- เลือกหน่วยงานต้นสังกัด ---</option>
                                  <option value="1">มหาวิทยาลัย (University)</option>
                                  <option value="2">โรงพยาบาล (Hospital)</option>
                                  <option value="99">อื่น ๆ (Other)</option>
                                </select>
                              </div>
                            </div>
                            <div class="col-sm-12">
                              <div class="form-group">
                                <label for="" class="txt-dark f500 fs08">ระบุชื่อหน่วยงานซึ่งจะระบุในใบรับรอง (ภาษาไทย) <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="top" title="เช่น ภาควิชาวิทยาการคอมพิวเตอร์ คณะวิทยาศาสตร์ มหาวิทยาลัยสงขลานครินทร์"></i> <span class="txt-danger">**</span></label>
                                <input type="text" class="form-control" placeholder="กรอกชื่อหน่วยงานของท่าน ..." id="txtDeptTh" >
                                <small id="passwordHelpBlock" class="form-text text-muted pl-5">
                                  Enter '-' if can not type institution's name in Thai.
                                </small>
                              </div>
                            </div>
                            <div class="col-sm-12">
                              <div class="form-group">
                                <label for="" class="txt-dark f500 fs08">Institution / Workplace in English for certificate of approval (English) <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="top" title="Example : Epidemiology Unit, Faulty of Medicine, Prince of Songkla University"></i> <span class="txt-danger">**</span></label>
                                <input type="text" class="form-control" placeholder="Enter the name of institution or workplace in English for certificate of approval ..." id="txtDeptEn" >
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- . part 2 -->

                <div class="col-sm-12 pt-20">
                  <h5><span class="text-success">ส่วนที่ 3 : </span>ข้อมูลการติดต่อ</h5>
                  <div class="row">
                    <div class="col-sm-12">
                      <div class="card mb-10">
                        <div class="card-body">
                          <div class="form-group">
                            <label for="" class="txt-dark f500 fs08">ที่อยู่ที่ติดต่อได้ (Address) <span class="txt-danger">**</span></label>
                            <textarea name="txtAddress" id="txtAddress" rows="2" cols="80" class="form-control" placeholder="กรอกที่อยู่ที่สามารถติดต่อได้ ..."></textarea>
                          </div>

                          <div class="row">
                            <div class="col-sm-4">
                              <div class="form-group">
                                <label for="" class="txt-dark f500 fs08">โทรศัพท์มือถือ (Mobile) <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="top" title="Example : 6674451165"></i> <span class="txt-danger">**</span></label>
                                <input type="number" min="0" class="form-control" placeholder="กรอกหมายเลขโทรศัพท์มือถือ (เฉพาะตัวเลข) ..." id="txtMobile">
                              </div>
                            </div>
                            <div class="col-sm-4">
                              <div class="form-group">
                                <label for="" class="txt-dark f500 fs08">โทรศัพท์ที่ทำงาน (Office)  <i class="fa fa-info-circle" data-toggle="tooltip" data-placement="top" title="Example : 074451165"></i> <span class="txt-danger">**</span></label>
                                <input type="number" min="0" class="form-control" placeholder="กรอกหมายเลขโทรศัพท์ที่ทำงาน (เฉพาะตัวเลข) ..." id="txtOffice">
                              </div>
                            </div>
                            <div class="col-sm-4">
                              <div class="form-group">
                                <label for="" class="txt-dark f500 fs08">อีเมล์ (E-mail address) <span class="txt-danger">**</span></label>
                                <input type="email" class="form-control" placeholder="กรอกอีเมล์แอดเดรสของท่าน ..." id="txtEmail">
                                <small id="passwordHelpBlock" class="form-text text-danger pl-5">
                                  ** ระบบแนะนำให้ใช้ Gmail, Hotmail หรือ Yahoo
                                </small>
                              </div>
                            </div>
                          </div>

                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- .part 3 -->

                <div class="col-sm-12 pt-20">
                  <h5><span class="text-success">ส่วนที่ 4 : </span>ตั้งรหัสผ่าน</h5>
                  <div class="row">
                    <div class="col-sm-12">
                      <div class="card mb-10">
                        <div class="card-body">
                          <div class="form-group">
                            <label for="" class="txt-dark f500 fs08">ตั้งรหัสผ่าน (Define password) <span class="txt-danger">**</span></label>
                            <input type="text" class="form-control" placeholder="กำหนดรหัสผ่านสำหรับบัญชีผู้ใช้งานของท่าน ..." id="txtPassword">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!-- .part 4 -->

                <div class="col-sm-12 pt-20 pb-30">
                  <div class="row">
                    <div class="col-sm-12 text-center">
                      <button class="btn btn-lg btn-secondary btn-lg" type="reset">รีเซ็ตฟอร์ม</button>
                      <button class="btn btn-lg btn-success btn-lg" type="submit">ลงทะเบียน</button>
                    </div>
                  </div>
                </div>
                <!-- .part 4 -->

              </div>


            </div>
            <!-- .col-sm-12 -->

          </div>
        </div>
      </form>



    <!-- jQuery -->
    <script src="v3/vendors/bower_components/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="v4/bower_components/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Slimscroll JavaScript -->
    <script src="v3/dist/js/jquery.slimscroll.js"></script>
    <!-- Fancy Dropdown JS -->
    <script src="v3/dist/js/dropdown-bootstrap-extended.js"></script>
    <!-- Sweet-Alert  -->
    <script src="v3/vendors/bower_components/sweetalert/dist/sweetalert.min.js"></script>

    <script src="v4/config.js"></script>

    <script type="text/javascript" src="v4/node_modules/preload.js/dist/js/preload.js"></script>

    <!-- Sweet-Alert  -->
    <script src="v3/main.js"></script>

    <script type="text/javascript">

      $(document).ready(function(){

        preload.hide()
        main.load_personnel_type_2()

        localStorage.clear();

        $w = $('body').width()
        if($w <= 475){
          $('#main-container').css('margin-top', '60px')
        }else{
          $('#main-container').css('margin-top', '60px')
        }
      })

      function showModal(id){
        $("#" + id).modal();
      }

      $(function(){

        $('[data-toggle="tooltip"]').tooltip()

        $('.register-form-v2').submit(function(){
            $check = 0;
            $('.form-control').removeClass('is-invalid')


            if($('#txtFnameTh').val()==''){
              $check++;
              $('#txtFnameTh').addClass('is-invalid')
            }

            if($('#txtLnameTh').val()==''){
              $check++;
              $('#txtLnameTh').addClass('is-invalid')
            }

            if($('#txtFnameEn').val()==''){
              $check++;
              $('#txtFnameEn').addClass('is-invalid')
            }

            if($('#txtLnameEn').val()==''){
              $check++;
              $('#txtLnameEn').addClass('is-invalid')
            }

            if($('#txtPosition').val()==''){
              $check++;
              $('#txtPosition').addClass('is-invalid')
            }

            if($('#txtExp').val()==''){
              $check++;
              $('#txtExp').addClass('is-invalid')
            }

            if($('#txtRI').val()==''){
              $check++;
              $('#txtRI').addClass('is-invalid')
            }

            if($('#txtDeptTh').val()==''){
              $check++;
              $('#txtDeptTh').addClass('is-invalid')
            }

            if($('#txtDeptEn').val()==''){
              $check++;
              $('#txtDeptEn').addClass('is-invalid')
            }

            if($('#txtInstitutionType').val()==''){
              $check++;
              $('#txtInstitutionType').addClass('is-invalid')
            }

            if($('#txtAddress').val()==''){
              $check++;
              $('#txtAddress').addClass('is-invalid')
            }

            if($('#txtMobile').val()==''){
              $check++;
              $('#txtMobile').addClass('is-invalid')
            }

            if($('#txtOffice').val()==''){
              $check++;
              $('#txtOffice').addClass('is-invalid')
            }

            if($('#txtEmail').val()==''){
              $check++;
              $('#txtEmail').addClass('is-invalid')
            }

            if($('#txtPassword').val()==''){
              $check++;
              $('#txtPassword').addClass('is-invalid')
            }

            if($check!=0){
              swal("ขออภัย!", "กรุณากรอกข้อมูลให้ครบถ้วน!", "error")
              return ;
            }

            preload.show()

            $sid_gen = main_app.randomString(30)

            var param = {
              prefix_th: $('#txtPrefixTh').val(),
              prefix_en: $('#txtPrefixEn').val(),
              fname_th: $('#txtFnameTh').val(),
              fname_en: $('#txtFnameEn').val(),
              lname_th: $('#txtLnameTh').val(),
              lname_en: $('#txtLnameEn').val(),
              position: $('#txtPosition').val(),
              exp: $('#txtExp').val(),
              ri: $('#txtRI').val(),
              institution: $('#txtInstitutionType').val(),
              dept_th: $('#txtDeptTh').val(),
              dept_en: $('#txtDeptEn').val(),
              address: $('#txtAddress').val(),
              mobile: $('#txtMobile').val(),
              office: $('#txtOffice').val(),
              email: $('#txtEmail').val(),
              password: $('#txtPassword').val(),
              sid: $sid_gen
            }

            var jxr = $.post(ws_url + 'controller/register_v3.php', param, function(){}, 'json')
                       .always(function(snap){

                          $full_name = $('#txtFnameTh').val() + ' ' + $('#txtLnameTh').val()
                          if($('#txtFnameTh').val() == '-'){
                           $full_name = $('#txtFnameEn').val() + ' ' + $('#txtLnameEn').val()
                          }

                          if((snap != '') && (snap.length > 0)){
                            snap.forEach(ele => {
                              console.log(ele);
                              if(ele.reg_status == 'Duplicate'){
                                preload.hide()
                                swal("ขออภัย!", "พบอีเมลน์นี้แล้วในระบบ หากอีเมล์นี้เป็นของท่าน กรุณากด 'ลืมรหัสผ่าน' ในหน้า Login", "error")
                              }
                              else if(ele.reg_status == 'Success'){
                                // Send and email for verification
                                var dataContent = '<h3>ข้อมูลการลงทะเบียนเพื่อเข้าใช้งานระบบสารสนเทศเพื่อการจัดการงานวิจัย (RMIS) </h3>' +
                                                  '<p>เรียน คุณ' + $full_name + '</p>' +
                                                  '<p>ท่านได้ทำการลงทะเบียนเพื่อใช้งานระบบสารสนเทศเพื่อการจัดการงานวิจัย (RMIS) เรียบร้อยแล้ว กรุณาทำการยืนยันบัญชีผู้ใช้โดยคลิกลิงค์นี้ ' + config.root_domain +'controller/avtivate.php?email=' + $('#txtEmail').val() + '&sid=' + $sid_gen + ' ' +
                                                  '(ถ้าไม่สามารถคลิกได้ ให้ทำการคัดลอกและนำไปเปิดกับหน้าเว็บด้วยตัวท่านเอง) ทั้งนี้ ท่านสามารถเข้าใช้งานระบบได้ทาง <a href="' + config.root_domain + '" target="_blank">' + config.root_domain + '</a> โดยใช้ข้อมูลดังต่อไปนี้' +
                                                  '</p>' +
                                                  '<p>ชื่อบัญชีผู้ใช้ : ' + $('#txtEmail').val() + '<br>รหัสผ่าน <span style="color:red;">: ' + $('#txtPassword').val() + '<span></p>' +
                                                  '<p>จึงเรียนมาเพื่อทราบ <br>ระบบสารสนเทศเพื่อการจัดการงานวิจัย (RMIS)</p>' + '<p style="color:red;">** กรุณาเก็บข้อมูลอีเมล์ฉบับนี้ไว้เนื่องจากท่านอาจต้องใช้ในอนาคต</p>'

                                var param = {
                                  title: 'ข้อมูลการสมัครใช้งานระบบสารสนเทศเพื่อการจัดการงานวิจัย (RMIS)',
                                  content: dataContent,
                                  user: 'tagoon.p@gmail.com',
                                  key: 'idj&skeoXf2**r123X',
                                  toemail: $('#txtEmail').val(),
                                  toname: $full_name
                                }

                                var jxr = $.post('http://simanh.psu.ac.th/icustomsystem/mailer/sender.php', param, function(){})
                                           .always(function(resp){
                                             if(resp == 'Y'){
                                               preload.hide()
                                               try {
                                                 preload.hide()
                                               } catch (e) {

                                               } finally {

                                               }
                                               swal({
                                                 title: "ดำเนินการสำเร็จ",
                                                 text: 'ท่านได้ลงทะเบียนสำเร็จแล้ว กรุณาตรวจสอบอีเมล์เพื่อทำการยืนยันตัวตน หากไม่ได้รับอีเมล์ใน 5 นาทีกรุณาติดต่อเจ้าหน้าที่',
                                                 type: "success",
                                                 showCancelButton: false,
                                                 confirmButtonColor: "#126cd5",
                                                 confirmButtonText: "ตกลง",
                                                 closeOnConfirm: true
                                               },
                                               function(){
                                                 window.location = 'index.html'
                                               });

                                             }else{
                                               preload.hide()
                                               swal({
                                                 title: "คำเตือน",
                                                 text: 'ระบบได้ดำเนินการตามกระบวนที่ท่านได้ดำเนินการแล้ว แต่เกิดข้อผิดพลาดในส่วนของการส่งอีเมล์ กรุณาแจ้งเจ้าหน้าที่เพื่อตรวจสอบและดำเนินการ',
                                                 type: "warning",
                                                 showCancelButton: false,
                                                 confirmButtonColor: "#126cd5",
                                                 confirmButtonText: "ตกลง",
                                                 closeOnConfirm: true
                                               },
                                               function(){
                                                 window.location = 'index.html'
                                               });
                                             }
                                           })
                                           return ;

                              }else{
                                console.log(ele.err_message);
                                console.log(ele.err_info);
                                preload.hide()
                                swal("ขออภัย!", "เกิดข้อผิดพลาด กรุณาลองใหม่ภายหลังหรือติดต่อเจ้าหน้าที่", "error")
                              }
                            })
                          }else{
                            preload.hide()
                          }
                       })

        })
      })
    </script>
</body>
</html>
